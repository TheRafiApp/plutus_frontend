
WSGIPythonHome /var/www/app/api/env/
WSGIPythonPath /var/www/app/api/api/

# api ##########################################################################

<VirtualHost api.staging.payment.rafiproperties.com:80>
   ServerName api.staging.rafiproperties.com
   Redirect permanent / https://api.staging.payment.rafiproperties.com/
</VirtualHost>

<VirtualHost api.staging.payment.rafiproperties.com:443>

  DocumentRoot /var/www/app/api/
  ServerName api.staging.payment.rafiproperties.com

  # environment
  SetEnv plutus_environment staging

  # SSLg
  SSLEngine on
  SSLCertificateFile /etc/letsencrypt/live/api.staging.payment.rafiproperties.com/cert.pem
  SSLCertificateKeyFile /etc/letsencrypt/live/api.staging.payment.rafiproperties.com/privkey.pem
  SSLCertificateChainFile /etc/letsencrypt/live/api.staging.payment.rafiproperties.com/fullchain.pem

  # favicon
  Alias "/favicon.ico" "/var/www/app/api/data/favicon.ico"

  # application
  WSGIScriptAlias / /var/www/app/api/api.wsgi
  WSGIPAssAuthorization On
  WSGIDaemonProcess api-development-1 processes=1 threads=1
  WSGIApplicationGroup api
  <Directory "/var/www/app/api">
    Options All -Indexes
    Require all denied
    Order deny,allow
    Deny from all
    <Files "api.wsgi">
      Require all granted
      Order allow,deny
      Allow from all
    </Files>
  </Directory>

  # headers
  Header set Access-Control-Allow-Origin *
  Header set Access-Control-Allow-Methods "POST, GET, OPTIONS, DELETE, PUT"
  Header set Access-Control-Allow-Headers "password, authorization, activation, refresh, Content-Type, origin, x-requested-with, accept, client-security-token"

  # logs
  LogLevel info
  CustomLog /var/www/app/api/logs/apache_access.log combined
  ErrorLog /var/www/app/api/logs/apache_error.log

  # server errors
  ErrorDocument 500 /var/www/app/api/data/server_error.json
  ErrorDocument 502 /var/www/app/api/data/server_error.json
  ErrorDocument 503 /var/www/app/api/data/server_error.json
  ErrorDocument 504 /var/www/app/api/data/server_error.json
</VirtualHost>

# frontend #####################################################################

<VirtualHost app.staging.payment.rafiproperties.com:80>
   ServerName app.staging.payment.rafiproperties.com
   Redirect permanent / https://app.staging.payment.rafiproperties.com/
</VirtualHost>

<VirtualHost app.staging.payment.rafiproperties.com:443>
  DocumentRoot /var/www/app/frontend
  ServerName app.staging.payment.rafiproperties.com

  # ssl
  SSLEngine on
  SSLCertificateFile /etc/letsencrypt/live/app.staging.payment.rafiproperties.com/cert.pem
  SSLCertificateKeyFile /etc/letsencrypt/live/app.staging.payment.rafiproperties.com/privkey.pem
  SSLCertificateChainFile /etc/letsencrypt/live/app.staging.payment.rafiproperties.com/fullchain.pem

  # application
  <Directory /var/www/app/frontend>
    Options All -Indexes
    Order allow,deny
    Allow from all
    Require all granted
    RewriteEngine On
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_URI} !\.(html|css|js|svg|map)$
    RewriteRule (.*) "index_staging.html" [L,QSA]
    DirectoryIndex index_staging.html
  </Directory>

  # headers
  Header set Access-Control-Allow-Origin *
  Header set Access-Control-Allow-Methods "POST, GET, OPTIONS, DELETE, PUT"
  Header set Access-Control-Allow-Headers "password, authorization, activation, refresh, Content-Type, origin, x-requested-with, accept, client-security-token"

  # logs
  LogLevel info
  CustomLog /var/www/app/frontend/logs/apache_access.log combined
  ErrorLog /var/www/app/frontend/logs/apache_error.log

  # server errors
  ErrorDocument 500 /var/www/app/api/data/server_error.json
  ErrorDocument 502 /var/www/app/api/data/server_error.json
  ErrorDocument 503 /var/www/app/api/data/server_error.json
  ErrorDocument 504 /var/www/app/api/data/server_error.json
</VirtualHost>

# public site ##################################################################

<VirtualHost staging.payment.rafiproperties.com:443>
   ServerName staging.payment.rafiproperties.com
   Redirect permanent / http://staging.payment.rafiproperties.com/
</VirtualHost>

<VirtualHost staging.payment.rafiproperties.com:80>
  DocumentRoot /var/www/site/build/
  ServerName staging.payment.rafiproperties.com

  <Directory /var/www/site/build/>
    Options All -Indexes
    Order allow,deny
    Allow from all
    Require all granted
    RewriteEngine On
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_URI} !\.(html|css|js|svg|map)$
    RewriteRule (.*) "index.html" [L,QSA]
  </Directory>
</VirtualHost>