define(["app","view/modals/ModalView","collection/account/FundingSourcesCollection","collection/users/ManagersCollection","model/transfers/TransferModel","view/repeaters/date-calendar","text!templates/modals/modal-transfer.html"],function(e,t,n,i,o,s,a){return t.extend({events:{"blur .amount":"validateAmount"},title:function(){var e="non-electronic"===this.type?type:"";return this.action+" "+e+" Transfer"},template:_.template(a),initialize:function(t){t&&_.extend(this,t);var s=this,a=e.utils.promises(2);this.model||(this.model=new o(null,{action:"add"})),this.managers=new i,this.managers.fetch().then(function(){a[0].resolve()}),this.funding_sources=new n,this.funding_sources.fetch().then(function(){a[1].resolve()}),$.when.apply($,a).then(function(){s.renderModalView()})},validateAmount:function(t){var n=$(t.currentTarget).val(),i=e.utils.validateMoney(n);i&&e.controls.fieldError({element:$(t.currentTarget),type:"error",error:i})},render:function(){var t=this.funding_sources.toJSON(),n=e.session.user.get("dwolla_account.primary_funding_source"),i=t.find(function(e){return e.id===n});console.log(i);var o={type:this.type,amount:this.amount,company:e.session.user.get("company"),primary_fs:i};return"electronic"===this.type?o.destination=this.managers.toJSON():"non-electronic"===this.type&&(o.source=this.context.tenants),this.ready(o),"non-electronic"===this.type&&this.$el.find(".date-picker").html(new s({name:"date",context:this}).$el),this},confirm:function(){var t=this,n=this.constructData();return"non-electronic"===this.type&&(n.bill=this.context.model.get("_id")),!!e.utils.validate(this,n)&&(this.$el.find(".modal").addClass("loading"),void this.model.save(n).then(function(){var i=n.amount,o=t.model.get("display_balance");t.model.set({updated:moment.utc().toISOString(),display_balance:o-i}),t.model.unset("amount",{silent:!0}),t.$el.find(".modal").addClass("success"),e.controls.wait(1900).then(function(){t.$el.find(".modal").removeClass("loading success"),t.context.trigger(t.eventName),t.closeModal()})}).fail(function(){console.warn(arguments)}))}})});
//# sourceMappingURL=ModalTransferView.js.map
