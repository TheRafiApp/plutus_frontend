define(["app"],function(t){var e=t.Model.extend({name:"bill",displayName:"date_pretty",filters:["address"],initialize:function(t,e){e||(e={}),this.options||(this.options={}),this.options=_.extend(this.options,e),this.options.base||(this.options.base="")},urlRoot:function(){return t.API()+this.options.base+"bills/"},address:Backbone.computed("unit","property",function(){var t=this.get("property"),e=this.get("unit");if("object"==typeof e)return t.address+" #"+e.number+", "+t.city+" "+t.state}),date_pretty:Backbone.computed("due_date",function(){var t=this.get("due_date");if(t)return moment.utc(t).format("MM/DD/YYYY")}),charges_pretty:Backbone.computed("charges",function(){var e=$.extend(!0,{},this.attributes),a=e.charges;if(!_.isEmpty(a))return a.scheduled&&(a.scheduled=a.scheduled.map(function(e){return e.amount=t.utils.parseMoney(e.amount),e})),a.recurring&&(a.recurring=a.recurring.map(function(e){return e.amount=t.utils.parseMoney(e.amount),e})),a}),status:Backbone.computed("display_balance","due_date",function(){var t,e=this.get("display_balance"),a=moment.utc(this.get("due_date")).startOf("day"),s=moment.utc().startOf("day");if(a)return 0===e?t="paid":a<s?t="overdue":a>s?t="created":a.isSame(s)&&(t="due"),t}),message:Backbone.computed("lease","display_balance","due_date","updated","status",function(){var e,a,s,n=this.get("status"),i=this.get("display_balance"),r=this.get("lease"),u=moment.utc(this.get("due_date")).startOf("day"),o=moment.utc(this.get("updated")).startOf("day"),d=moment.utc().startOf("day"),c=Math.abs(moment.duration(u.diff(d)).asDays());if(u&&r){var p=_.each(r.autopay,function(e){return e===t.session.user.id});return 0===i?(e="Paid in full",a=o):u<d?(e="Overdue "+c+" days",a=u):u>d?(e="Due in "+c+" days",a=u,s=!0):u.isSame(d)&&(e="Due today",a=d,s=!0),s&&p&&(e="Autopay in "+c+" days"),'<span class="status status-'+n+'">'+e+"</span> "+a.format("MM/DD/YYYY")}}),target:Backbone.computed("type","property","unit",function(){var t,e=this.get("type");if(e){if("monthly"===e){var a=this.get("property"),s=this.get("unit");t=a.address+" #"+s.number}else if("anytime"===e){var n=this.get("tenants");t=1===n.length?n[0].first_name+" "+n[0].last_name:n.length+" Roommates"}return t}}),transfers_by_user:Backbone.computed("transfers","tenants",function(){var t=this.get("tenants"),e=this.get("transfers");if(t){var a={};return t.map(function(t){var s=t._id,n=0;e&&e.map(function(t){t.source!=s||["failed",500].contains(t.status.state)||(n+=t.amount)}),a[s]=n}),a}}),schema:{due_date:{type:"ISO"},charges:{scheduled:[{amount:{type:"charge"}}]},tenants:{type:"array"}},validation:{tenants:{required:!0},"charges.scheduled":t.utils.validateCharges}});return e});
//# sourceMappingURL=BillModel.js.map
