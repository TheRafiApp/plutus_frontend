define(["app","view/modals/ModalView","collection/account/FundingSourcesCollection","model/transfers/TransferModel","view/repeaters/date-calendar","text!templates/modals/modal-transfer.html"],function(t,e,n,i,o,a){return e.extend({events:{"blur .amount":"validateAmount"},title:function(){var t="offline"===this.type?this.type:"";return this.action+" "+t+" Payment"},template:_.template(a),initialize:function(t){t&&_.extend(this,t);var e=this;this.model||(this.model=new i(null,{action:"add"})),this.funding_sources=new n,this.funding_sources.fetch().then(function(){e.renderModalView()})},validateAmount:function(e){var n=$(e.currentTarget).val(),i=t.utils.validateMoney(n);i&&t.controls.fieldError({element:$(e.currentTarget),type:"error",error:i})},render:function(){var e=this.funding_sources.toJSON(),n=t.session.user.get("dwolla_account.primary_funding_source"),i=e.find(function(t){return t.id===n}),a={type:this.type,amount:this.amount,company:t.session.user.get("company"),primary_fs:i};return"electronic"===this.type?a.destination=this.managers.toJSON():"offline"===this.type&&(a.source=this.context.tenants),this.ready(a),"offline"===this.type&&this.$el.find(".date-picker").html(new o({name:"date",context:this}).$el),this},confirm:function(){var e=this,n=this.constructData();return"offline"===this.type&&(n.bill=this.context.model.get("_id")),!!t.utils.validate(this,n)&&(this.$el.find(".modal").addClass("loading"),void this.model.save(n).then(function(){var i=n.amount,o=e.model.get("display_balance");e.model.set({updated:moment.utc().toISOString(),display_balance:o-i}),e.model.unset("amount",{silent:!0}),e.$el.find(".modal").addClass("success"),t.controls.wait(1900).then(function(){e.$el.find(".modal").removeClass("loading success"),e.context.trigger(e.eventName),e.closeModal()})}).fail(function(){console.warn(arguments)}))}})});
//# sourceMappingURL=ModalTransferView.js.map
