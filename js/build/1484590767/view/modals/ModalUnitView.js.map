{"version":3,"sources":["view/modals/ModalUnitView.js"],"names":["define","app","ModalView","UnitModel","ModalUnitTemplate","extend","title","action","utils","capitalize","this","messages","success","error","template","_","initialize","_options","parentModel","context","model","parentModelId","get","renderModalView","render","ready","unit","toJSON","decimals","$el","find","mask","translation","z","pattern","number","confirm","self","formData","constructData","property","validate","save","then","trigger","eventName","closeModal","fail","e","message","responseJSON","contains","alerts","console","warn","arguments"],"mappings":"AAIAA,QACE,MACA,wBACA,6BACA,yCAEF,SACEC,EACAC,EACAC,EACAC,GAGA,MAAOF,GAAUG,QAEfC,MAAO,WACL,GAAIC,GAASN,EAAIO,MAAMC,WAAWC,KAAKH,OACvC,OAAOA,GAAS,SAGlBI,UACEC,QAAS,0BACTC,MAAO,+BAGTC,SAAUC,EAAED,SAASV,GAErBY,WAAY,SAASC,GACfA,GAAUF,EAAEV,OAAOK,KAAMO,GAE7BP,KAAKQ,YAAcR,KAAKS,QAAQD,YAEhCR,KAAKU,MAAQ,GAAIjB,GAAU,MACzBkB,cAAeX,KAAKQ,YAAYI,IAAI,SAGtCZ,KAAKa,mBAGPC,OAAQ,WAGNd,KAAKe,OACHC,KAAMhB,KAAKU,MAAMO,UAGnB,IAAIC,GAAWlB,KAAKmB,IAAIC,KAAK,0CAC7BF,GAASG,KAAK,QACZC,aACEC,GACEC,QAAS,aAKf,IAAIC,GAASzB,KAAKmB,IAAIC,KAAK,sBAG3B,OAFAK,GAAOJ,KAAK,UAELrB,MAGT0B,QAAS,WACP,GAAIC,GAAO3B,KAEP4B,EAAW5B,KAAK6B,eAGpB,OAFAD,GAASE,SAAW9B,KAAKQ,YAAYI,IAAI,SAEpCrB,EAAIO,MAAMiC,SAAS/B,KAAM4B,QAE9B5B,MAAKU,MAAMsB,KAAKJ,GAAUK,KAAK,WAC7BN,EAAKlB,QAAQyB,QAAQP,EAAKQ,WAC1BR,EAAKS,eACJC,KAAK,SAASC,GACf,GACIC,GADApC,EAAQmC,EAAEE,YAGZD,GADEpC,EAAMoC,QAAQE,SAAS,YAAa,OAC5B,2DAEA,6CAEZlD,EAAImD,OAAOvC,MAAMoC,GACjBI,QAAQC,KAAKC","file":"ModalUnitView.js","sourcesContent":["/**\n * ModalUnitView.js\n */\n\ndefine([\n  'app',\n  'view/modals/ModalView',\n  'model/properties/UnitModel',\n  'text!templates/modals/modal-unit.html'\n],\nfunction(\n  app, \n  ModalView,\n  UnitModel, \n  ModalUnitTemplate\n) {\n\n  return ModalView.extend({\n\n    title: function() {\n      var action = app.utils.capitalize(this.action);\n      return action + ' Unit';\n    },\n\n    messages: {\n      success: 'The unit has been saved',\n      error: 'The unit could not be saved'\n    },\n\n    template: _.template(ModalUnitTemplate),\n\n    initialize: function(_options) {\n      if (_options) _.extend(this, _options);\n\n      this.parentModel = this.context.parentModel;\n\n      this.model = new UnitModel(null, {\n        parentModelId: this.parentModel.get('_id')\n      });\n\n      this.renderModalView();\n    },\n\n    render: function() {\n      var self = this;\n\n      this.ready({\n        unit: this.model.toJSON()\n      });\n\n      var decimals = this.$el.find('input[name=\"beds\"], input[name=\"baths\"]');\n      decimals.mask('zzzz', {\n        translation: {\n          'z': {\n            pattern: /[0-9\\.]/\n          }\n        }\n      });\n\n      var number = this.$el.find('input[name=\"sq_ft\"]');\n      number.mask('000000');\n\n      return this;\n    },\n\n    confirm: function() {\n      var self = this;\n\n      var formData = this.constructData();\n      formData.property = this.parentModel.get('_id');\n\n      if (!app.utils.validate(this, formData)) return false;\n\n      this.model.save(formData).then(function() {\n        self.context.trigger(self.eventName);\n        self.closeModal();\n      }).fail(function(e) {\n        var error = e.responseJSON;\n        var message;\n        if (error.message.contains('duplicate', 'key')) {\n          message = 'There is already a unit with that number on the property';\n        } else {\n          message = 'Sorry, unable to create unit at this time.';\n        }\n        app.alerts.error(message);\n        console.warn(arguments);\n      });\n    }\n\n  });\n});"]}