{"version":3,"sources":["view/MyleaseView.js"],"names":["define","app","TenantModel","MyLeaseModel","UserCardView","ModalSplitView","MyLeaseTemplate","Backbone","View","extend","_","Events","className","events","click .action-edit-split","template","initialize","_options","this","self","model","_id","router","getPage","fetch","then","render","fail","e","console","warn","attachEvents","on","listening","$el","html","lease","toJSON","prettyMoney","utils","tenants","$","get","my_id","session","user","id","sort","a","b","log","split","each","tenant","tenantModel","tenant_card","data","amount","find","append","removeClass","showSplitModal","modal","action","eventName","context"],"mappings":"AAIAA,QACE,MACA,0BACA,4BACA,2BACA,6BACA,sCAEF,SAASC,EAAKC,EAAaC,EAAcC,EAAcC,EAAgBC,GAErE,MAAOC,UAASC,KAAKC,OAAOC,EAAED,UAAWF,SAASI,QAEhDC,UAAa,mBAEbC,QACEC,2BAA4B,kBAG9BC,SAAUL,EAAEK,SAAST,GAErBU,WAAY,SAASC,GACfA,GAAUP,EAAED,OAAOS,KAAMD,EAC7B,IAAIE,GAAOD,IAEXA,MAAKE,MAAQ,GAAIjB,IAAekB,IAAKpB,EAAIqB,OAAOC,YAChDL,KAAKE,MAAMI,QAAQC,KAAK,WACtBN,EAAKO,WACJC,KAAK,SAASC,GACfC,QAAQC,KAAKF,MAIjBG,aAAc,WACZb,KAAKc,GAAG,YAAad,KAAKF,WAAYE,MACtCA,KAAKe,WAAY,GAGnBP,OAAQ,WACDR,KAAKe,WAAWf,KAAKa,cAE1B,IAAIZ,GAAOD,IAEXA,MAAKgB,IAAIC,KAAKjB,KAAKH,UACjBqB,MAAOlB,KAAKE,MAAMiB,SAClBC,YAAarC,EAAIsC,MAAMD,cAKzB,IAAIE,GAAUC,EAAEhC,QAAO,KAAUS,KAAKE,MAAMsB,IAAI,YAC5CC,EAAQ1C,EAAI2C,QAAQC,KAAKC,EAE7BN,GAAUA,EAAQO,KAAK,SAASC,EAAGC,GACjC,MAAID,GAAE3B,MAAQsB,GACL,EACEM,EAAE5B,MAAQsB,EACZ,EADF,SAKTd,QAAQqB,IAAIV,EAEZ,IAAIW,GAAQjC,KAAKE,MAAMsB,IAAI,QAc3B,OAZAhC,GAAE0C,KAAKZ,EAAS,SAASa,GACvB,GAAIC,GAAc,GAAIpD,GAAYmD,GAC9BE,EAAc,GAAInD,IACpBoD,KAAMF,EAAYjB,SAClBoB,OAAQN,EAAME,EAAOhC,MAGvBF,GAAKe,IAAIwB,KAAK,gBAAgBC,OAAOJ,EAAYrB,OAGnDO,EAAE,aAAamB,YAAY,WAEpB1C,MAGT2C,eAAgB,WACd3C,KAAK4C,MAAQ,GAAIzD,IACf0D,OAAQ,OACRC,UAAW,YACXC,QAAS/C","file":"MyleaseView.js","sourcesContent":["/**\n * MyLeaseView.js\n */\n\ndefine([\n  'app',\n  'model/users/TenantModel',\n  'model/leases/MyLeaseModel',\n  'view/cards/user_payments',\n  'view/modals/ModalSplitView',\n  'text!templates/leases/mylease.html'\n],\nfunction(app, TenantModel, MyLeaseModel, UserCardView, ModalSplitView, MyLeaseTemplate) {\n\n  return Backbone.View.extend(_.extend({}, Backbone.Events, {\n\n    'className': 'panel lease-view',\n    \n    'events': {\n      'click .action-edit-split': 'showSplitModal'\n    },\n\n    template: _.template(MyLeaseTemplate),\n\n    initialize: function(_options) {\n      if (_options) _.extend(this, _options);\n      var self = this;\n\n      this.model = new MyLeaseModel({ _id: app.router.getPage() });\n      this.model.fetch().then(function() {\n        self.render();\n      }).fail(function(e) {\n        console.warn(e);\n      });\n    },\n\n    attachEvents: function() {\n      this.on('editSplit', this.initialize, this);\n      this.listening = true;\n    },\n\n    render: function() {\n      if (!this.listening) this.attachEvents();\n\n      var self = this;\n\n      this.$el.html(this.template({\n        lease: this.model.toJSON(),\n        prettyMoney: app.utils.prettyMoney\n      }));\n\n      // need to deep copy the tenants array so the sorting\n      // doesn't impact the order of the split modal\n      var tenants = $.extend(true, [], this.model.get('tenants'));\n      var my_id = app.session.user.id;\n\n      tenants = tenants.sort(function(a, b) {\n        if (a._id === my_id) {\n          return -1;\n        } else if (b._id === my_id) {\n          return 1;\n        }\n      });\n\n      console.log(tenants);\n\n      var split = this.model.get('split');\n\n      _.each(tenants, function(tenant) {\n        var tenantModel = new TenantModel(tenant);\n        var tenant_card = new UserCardView({ \n          data: tenantModel.toJSON(),\n          amount: split[tenant._id]\n        });\n\n        self.$el.find('.split-cards').append(tenant_card.$el);\n      });\n\n      $('.tertiary').removeClass('loading');\n\n      return this;\n    },\n\n    showSplitModal: function() {\n      this.modal = new ModalSplitView({\n        action: 'edit',\n        eventName: 'editSplit',\n        context: this\n      });\n    }\n    \n  }));\n});"]}