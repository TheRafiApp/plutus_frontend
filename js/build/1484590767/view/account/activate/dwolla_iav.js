define(["app","text!templates/account/activate/dwolla_iav.html","https://cdn.dwolla.com/1/dwolla.js"],function(e,t){return Backbone.View.extend({className:"dwolla",template:_.template(t),events:{"click .action-next":"nextStep"},initialize:function(t){t&&_.extend(this,t);var s=this;this.user=this.parentView.user;var i;i=e.session.get("logged_in")?this.user.get("status.active")?"account/iav":this.user.get("role")+"s/dwolla":this.user.get("role")+"s/activate/dwolla",e.utils.request({path:i,method:"GET"}).then(function(e){var t=s.user.get("dwolla")||{};t.iav_token=e,s.parentView.user.set({dwolla:t}),s.render()}).fail(function(t){e.controls.handleError(t)})},render:function(){var t=this;this.$el.html(this.template({logo:e.templates.logo()})),this.step.dwolla_account&&this.step.dwolla_account.primary_funding_source;var s=this.user.get("dwolla.iav_token");return dwolla.configure(e.config.dwolla_env),dwolla.iav.start(s,{container:"iav-container",stylesheets:["https://fonts.googleapis.com/css?family=Roboto",e.url.base_url+"/css/dwolla_style.css"],microDeposits:!1,fallbackToMicroDeposits:!0},function(s,i){i?t.processDwollaResponse(i):s&&e.controls.handleError(s)}),this.$el.find("iframe").one("load",$.proxy(this.iframeLoaded,this)),this},iframeLoaded:function(){this.$el.find(".overlay.loading").remove()},processDwollaResponse:function(t){var s,i=this,a={id:t._links["funding-source"].href.split("funding-sources/")[1],status:t._links["verify-micro-deposits"]?"unverified":"verified"},n="POST";e.session.get("logged_in")?(s="account/funding_sources",n="PUT"):s=i.user.get("role")+"s/activate/funding_sources",e.utils.request({path:s,method:n,data:a}).then(function(e){"unverified"===e.status,i.parentView.user.set(e),i.parentView.next()})},renderAllSet:function(){var e='<div class="form-model"><h1>Bank Account</h1>';e+='<div class="all-set">You\'ve already linked your bank account!</div>',e+='<div class="pad-20"><a href="#" class="btn action-next">Next</a></div></div>',this.$el.find("#iav-container").html(e)},nextStep:function(){this.parentView.next()}})});
//# sourceMappingURL=dwolla_iav.js.map
