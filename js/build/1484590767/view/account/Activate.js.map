{"version":3,"sources":["view/account/Activate.js"],"names":["define","app","ActivationTemplate","Backbone","View","extend","className","template","_","events","click .breadcrumb","dwolla_data","initialize","options","this","AccountModel","models","user","session","get","utils","stash","removeItem","router","navigate","trigger","replace","alerts","error","$el","html","append","templates","logo","render","updateUser","userData","$","removeClass","renderSteps","checkStep","i","steps","length","currentStep","value","showStep","loginAndClose","getOnboardingSteps","toJSON","console","log","$breadcrumb","href","class","data-name","name","data-step","find","fade","step","self","loadView","then","stepView","currentView","parentView","color","background","css","updateBreadcrumbs","index","addClass","next","nextIndex","checkAuth","close","fail","controls","login","goToStep","e","currentTarget","attr","setDwollaData","data"],"mappings":"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","file":"Activate.js","sourcesContent":["/**\n * ActivateView.js\n */\n\ndefine([\n  'app',\n  'text!templates/account/account-activation.html',\n],\nfunction(app, ActivationTemplate) {\n\n  return Backbone.View.extend({\n\n    className: 'activation dark',\n    template: _.template(ActivationTemplate),\n\n    events: {\n      'click .breadcrumb': 'goToStep'\n    },\n\n    dwolla_data: {},\n\n    initialize: function(options) {\n      if (options) _.extend(this, options);\n\n      // if user data was not passed, use session user\n      var AccountModel = app.models.AccountModel;\n\n      // make sure we have a real AccountModel instance\n      this.user = this.user ? new AccountModel(this.user) : app.session.user;\n    \n      // if user is not active yet, clear session tokens\n      if (this.user.get('status.password') === false) {\n        app.utils.stash.removeItem('authorization');\n        app.utils.stash.removeItem('refresh');\n      } else {\n        if (app.session.get('logged_in') === false) {\n          app.router.navigate('/', { trigger: true, replace: true });\n          return app.alerts.error('You have already activated your account, please log in');\n        }\n      }\n\n      this.$el.html(this.template());\n      this.$el.append(app.templates.logo());\n\n      this.render();\n\n      return this;\n    },\n\n    updateUser: function(userData) {\n      _.extend(this.user, userData);\n      this.initialize();\n    },\n\n    render: function() {\n      $('body').removeClass('loading');\n      var self = this;\n\n      this.renderSteps();\n\n      return this;\n    },\n\n    checkStep: function() {\n      // loop thru steps and evaluate status\n      for (var i=0; i<this.steps.length; i++) {\n        var currentStep = this.steps[i];\n        if (!currentStep.value) {\n          // call the method of the first step that isnt complete\n          this.currentStep = currentStep;\n          this.showStep(currentStep);\n          break;\n        }\n        // if all steps are done\n        if (i === (this.steps.length - 1)) this.loginAndClose();\n      }\n    },\n\n    renderSteps: function() {\n      this.steps = app.utils.getOnboardingSteps(this.user.toJSON());\n\n      console.log(this.steps)\n\n      // render breadcrumbs\n      if (this.steps.length > 1) {\n        for (var i=0; i<this.steps.length; i++) {\n          \n          var $breadcrumb = $('<a>', {\n            'href': '#',\n            'class': 'breadcrumb',\n            'data-name': this.steps[i].name,\n            'data-step': i\n          });\n          this.$el.find('.breadcrumbs').append($breadcrumb);\n        }\n      }\n\n      this.$el.find('.container').append($('<div class=\"fade\"></div>'));\n      this.fade = this.$el.find('.fade');\n\n      this.checkStep();\n    },\n\n    showStep: function(step) {\n      var self = this;\n\n      app.utils.loadView.get('account/activate/' + step.name).then(function(stepView) {\n        self.currentView = new stepView({\n          step: step,\n          parentView: self\n        });\n\n        // update background color\n        var color = step.options.background;\n        self.$el.css('background-color', color)\n          .find('.step')\n          .html(self.currentView.$el);\n        \n        // update overflow fade\n        self.fade.css('box-shadow', 'inset 0 -19px 10px -12px ' + color);\n\n        self.updateBreadcrumbs(step);\n        self.$el.find('.container').removeClass('loading');\n      });\n    },\n\n    updateBreadcrumbs: function(step) {\n      var index = step.index;\n\n      this.$el.find('.breadcrumb').removeClass('current');\n      for (var i=0; i<=index; i++) this.$el.find('.breadcrumb[data-step=\"' + i + '\"]').addClass('active');\n      this.$el.find('.breadcrumb[data-step=\"' + index + '\"]').addClass('current');\n    },\n\n    next: function() {\n      var self = this;\n      var nextIndex = this.currentStep.index + 1;\n      if (nextIndex > (this.steps.length - 1)) {\n        this.loginAndClose();\n        return;\n      }\n\n      this.currentStep = this.steps[nextIndex];\n      this.showStep(this.currentStep);\n    },\n\n    loginAndClose: function() { \n      var self = this;\n      app.router.checkAuth().then(function() {\n        self.close();\n      }).fail(function() {\n        app.controls.login().then(function() {\n          self.close();\n        });\n      });\n    },\n\n    goToStep: function(e) {\n      var index = $(e.currentTarget).attr('data-step');\n      this.currentStep = this.steps[index];\n      this.showStep(this.currentStep);\n    },\n\n    setDwollaData: function(data) {\n      _.extend(this.dwolla_data, data);\n    }\n\n  });\n});"]}