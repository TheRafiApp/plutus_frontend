{"version":3,"sources":["view/LedgerView.js"],"names":["define","app","TransfersCollection","ModalAddView","TableView","TableRowView","TableRowTemplate","Backbone","View","extend","className","template","_","tips","header","body","initialize","this","render","attachEvents","listening","tableView","close","title","modelName","modelPlural","context","collection","row","options","filter","totals","edit","add","addModalOptions","action","eventName","$el","html","total_amount","pluck","reduce","a","b","transfer","source_name","destination","name","status","state","amount_pretty","utils","prettyMoney"],"mappings":"AAIAA,QACE,MACA,2CACA,8BACA,wBACA,gCACA,8CAEF,SACEC,EACAC,EACAC,EACAC,EACAC,EACAC,GAEA,MAAOC,UAASC,KAAKC,QAEnBC,UAAW,kBACXC,SAAUC,EAAED,SAASL,GAErBO,OAEIC,OAAU,aACVC,KAAQ,iKAIRD,OAAU,iBACVC,KAAQ,2FAKZC,WAAY,WACVC,KAAKC,UAGPC,aAAc,WACZF,KAAKG,WAAY,GAGnBF,OAAQ,WA8BN,MA7BKD,MAAKG,WAAWH,KAAKE,eACtBF,KAAKI,WAAWJ,KAAKI,UAAUR,KAAKS,QAExCL,KAAKI,UAAY,GAAIjB,IACnBmB,MAAO,SACPC,UAAW,QACXC,YAAa,UAEbC,QAAST,KAETU,WAAYzB,EACZ0B,IAAKvB,EAELwB,SACEC,QAAQ,EACRC,QAAQ,EAERC,MAAM,EACNC,IAAK9B,EACL+B,iBACEC,OAAQ,MACRC,UAAW,iBAMjBnB,KAAKoB,IAAIC,KAAKrB,KAAKI,UAAUgB,KAEtBpB,MAGTc,OAAQ,SAASV,GAEf,GAAIkB,GAAelB,EAAUM,WAAWa,MAAM,UAAUC,OAAO,SAASC,EAAEC,GACxE,MAAOD,GAAIC,GAGb,QACEC,UACEC,YAAa,GACbC,aACEC,KAAM,IAERC,QACEC,MAAO,IAETC,cAAejD,EAAIkD,MAAMC,YAAYb","file":"LedgerView.js","sourcesContent":["/**\n * LedgerView.js\n */\n\ndefine([\n  'app',\n  'collection/transfers/TransfersCollection',\n  'view/modals/ModalLedgerView',\n  'view/tables/TableView',\n  'view/tables/TableTransferView',\n  'text!templates/tables/table-transfers.html'\n],\nfunction(\n  app, \n  TransfersCollection, \n  ModalAddView, \n  TableView, \n  TableRowView, \n  TableRowTemplate) {\n\n  return Backbone.View.extend({\n\n    className: 'collection-view',\n    template: _.template(TableRowTemplate),\n\n    tips: [\n      { \n        'header': 'The Ledger',\n        'body': 'Ledger entries represent transactions. All payments made via Rafi Payment will be displayed here, as well as any non-electronic payments recorded to a bill.',\n        // 'link': 'http://google.com'\n      },\n      { \n        'header': 'Adding Entries',\n        'body': 'You may also record miscellaneous expenses or income related to your properties here. ',\n        // 'link': 'http://google.com'\n      },\n    ],\n\n    initialize: function() {\n      this.render();\n    },\n\n    attachEvents: function() {\n      this.listening = true;\n    },\n\n    render: function() {\n      if (!this.listening) this.attachEvents();\n      if (this.tableView) this.tableView.tips.close();\n      \n      this.tableView = new TableView({\n        title: 'Ledger',\n        modelName: 'entry',\n        modelPlural: 'entries',\n\n        context: this,\n        \n        collection: TransfersCollection,\n        row: TableRowView,\n        \n        options: {\n          filter: true,\n          totals: true,\n          // search: true,\n          edit: false,\n          add: ModalAddView,\n          addModalOptions: {\n            action: 'add',\n            eventName: 'modelAdded',\n          }\n        }\n          \n      });\n      \n      this.$el.html(this.tableView.$el);\n\n      return this;\n    },\n\n    totals: function(tableView) {\n\n      var total_amount = tableView.collection.pluck('amount').reduce(function(a,b) {\n        return a + b;\n      });\n      \n      return {\n        transfer: {\n          source_name: '', \n          destination: {\n            name: ''\n          }, \n          status: {\n            state: ''\n          },\n          amount_pretty: app.utils.prettyMoney(total_amount)\n        }\n      };\n    }\n\n  });\n});"]}