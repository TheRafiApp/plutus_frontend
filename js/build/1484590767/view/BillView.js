define(["app","view/cards/user_payments","view/modals/ModalTransferView","model/bills/BillModel","text!templates/bills/bill.html","text!templates/headers/header-tertiary-model.html"],function(e,t,i,n,a,s){return Backbone.View.extend(_.extend({},Backbone.Events,{className:"bill-view scroll-y",events:{"click .action-add-transfer":"addTransfer","click .action-delete":"promptDelete","click .action-close":"hideTertiary"},template:_.template(a),template_container:_.template(s),initialize:function(e){_.extend(this,e);var t=this;this.model=new n({_id:this._id}),Backbone.Validation.bind(this),this.model.fetch().then(function(){t.render()})},attachEvents:function(){this.on("transferAdded",this.initialize,this),this.on("confirmDelete",this.deleteModel,this),this.listening=!0},render:function(){var i=this;this.listening||this.attachEvents();var n=this.model.toJSON(),a={model:this.model.get("type")+" Bill â€“ "+this.model.display_name()};this.$el.html(this.template_container({header:a,options:{delete:!("anytime"!=this.model.get("type"))}})),this.$el.find(".scroll-y").html(this.template({bill:n,prettyMoney:e.utils.prettyMoney})),this.tenants=this.model.get("tenants");var s=this.model.get("transfers");return _.each(this.tenants,function(e){var n=e._id,a=0;s.forEach(function(e){e.source!=n||["failed",500].contains(e.status.state)||(a+=e.amount)});var l=new t({data:e,amount:a});i.$el.find(".transfer-cards").append(l.$el)}),$('.row[data-id="'+e.views.currentView.selected+'"]').addClass("selected"),$(".tertiary").removeClass("loading"),this},promptDelete:function(){var t=this.model.display_name(),i="Are you sure you want to delete "+t+"?";e.controls.modalConfirm(i,"confirmDelete",this)},deleteModel:function(){this.model.destroy().then(function(){console.log("success");var t=e.router.getRoute();e.router.navigate(t,{trigger:!0})}).fail(function(t){e.utils.handleError(t)})},hideTertiary:function(){e.views.modelView&&e.controls.hideTertiary()},addTransfer:function(){this.modal=new i({action:"add",type:"offline",eventName:"transferAdded",context:this})}}))});
//# sourceMappingURL=BillView.js.map
