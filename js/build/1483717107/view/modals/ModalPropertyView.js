define(["app","async!https://maps.googleapis.com/maps/api/js?key=AIzaSyAK_nfRIH9in6hPb1UxtyDL6FMCHANm6n4&libraries=places&callback=initMap","view/modals/ModalView","model/properties/PropertyModel","collection/account/FundingSourcesCollection","text!templates/modals/modal-property.html"],function(e,t,o,s,n,i){return o.extend({events:{"click .action-confirm":"confirm",'change input[name="pay_into_target"]':"updatePayInto","change .companies":"companiesChange"},messages:{success:"The property has been saved",error:"The property could not be saved"},template:_.template(i),title:function(){return this.action+" Property"},initialize:function(t){t&&_.extend(this,t);var o=this;this.model||(this.model=new s),this.collection=new n,e.controls.smartRender(o,{admin:[this.collection]}).then(function(){o.renderModalView()})},render:function(){this.eventName||(this.eventName="confirm");var t,o=this.model.toJSON();e.collections.companies&&(t=e.collections.companies.toJSON());var s=this.collection.toJSON();return this.ready({user:e.session.user.toJSON(),property:o,companies:t,funding_sources:s}),o&&this.setAddress(o),e.session.isSuperAdmin()&&this.companiesChange(),this.initMap(),this},updatePayInto:function(e){var t=$(e.currentTarget).val();"true"===t?this.$el.find(".pay-into .dropdown").show():this.$el.find(".pay-into .dropdown").hide()},setAddress:function(e){var t=this,o=["address","city","state","zip","country"];o.forEach(function(o){t[o]=e[o]})},initMap:function(){function t(){p.close(),m.setVisible(!1);var t=d.getPlace(),s=t.address_components,i={};return $.each(s,function(e,t){$.each(t.types,function(e,o){i[o]=t.long_name})}),t.geometry?(n.address=t.name,n.city=i.locality||i.sublocality,n.state=i.administrative_area_level_1,n.zip=i.postal_code,n.country=i.political,n.place_id=t.place_id,void o(t)):void e.controls.wait(200).then(function(){e.controls.fieldError({element:".address-selector",error:"Please select an address from the autocomplete menu"})})}function o(e){e.geometry.viewport?i.fitBounds(e.geometry.viewport):(i.setCenter(e.geometry.location),i.setZoom(17)),m.setIcon({url:e.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(35,35)}),m.setPosition(e.geometry.location),m.setVisible(!0);var t="";e.address_components&&(t=[e.address_components[0]&&e.address_components[0].short_name||"",e.address_components[1]&&e.address_components[1].short_name||"",e.address_components[2]&&e.address_components[2].short_name||""].join(" ")),p.setContent("<div><strong>"+e.name+"</strong><br>"+t),p.open(i,m)}function s(e,t,o,s){t.geocode({placeId:e},function(e,t){if(t===google.maps.GeocoderStatus.OK)if(e[0]){o.setZoom(11),o.setCenter(e[0].geometry.location);var n=new google.maps.Marker({map:o,position:e[0].geometry.location});s.setContent(e[0].formatted_address),s.open(o,n)}else window.alert("No results found");else window.alert("Geocoder failed due to: "+t)})}var n=this,i=new google.maps.Map(this.$el.find(".map")[0],{center:{lat:42.369117,lng:-71.062658},streetViewControl:!1,mapTypeControl:!1,zoomControl:!1,zoom:13}),r=[{featureType:"water",elementType:"geometry",stylers:[{color:"#70bdf0"},{saturation:"-22"}]},{featureType:"landscape",elementType:"geometry",stylers:[{color:"#f7f7f7"},{lightness:20}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#dedede"},{lightness:17}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#dedede"},{lightness:29},{weight:.2}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#dedede"},{lightness:18}]},{featureType:"road.local",elementType:"geometry",stylers:[{color:"#ffffff"},{lightness:16}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#f1f1f1"},{lightness:21}]},{elementType:"labels.text.stroke",stylers:[{visibility:"on"},{color:"#ffffff"},{lightness:16}]},{elementType:"labels.text.fill",stylers:[{saturation:36},{color:"#333333"},{lightness:40}]},{elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#f2f2f2"},{lightness:19}]},{featureType:"administrative",elementType:"geometry.fill",stylers:[{color:"#fefefe"},{lightness:20}]},{featureType:"administrative",elementType:"geometry.stroke",stylers:[{color:"#fefefe"},{lightness:17},{weight:1.2}]}];i.setOptions({styles:r});var a=new google.maps.Geocoder,l=this.$el.find(".address-selector")[0],c={types:["address"],componentRestrictions:{country:"usa"}},d=new google.maps.places.Autocomplete(l,c);d.bindTo("bounds",i);var p=new google.maps.InfoWindow,m=new google.maps.Marker({map:i,anchorPoint:new google.maps.Point(0,(-29))});d.addListener("place_changed",t);var y=this.model.get("place_id");y&&s(y,a,i,p)},companiesChange:function(){},constructData:function(){var e=this.$el.find("form"),t=e.serializeObject();return t.address=this.address,t.city=this.city,t.state=this.state,t.zip=this.zip,t.country=this.country,t.place_id=this.place_id,this.$el.find("#default").is(":checked")&&(t.dwolla.funding_source=null),delete t.pay_into_target,t}})});
//# sourceMappingURL=ModalPropertyView.js.map
