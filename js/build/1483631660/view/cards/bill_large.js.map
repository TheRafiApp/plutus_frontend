{"version":3,"sources":["view/cards/bill_large.js"],"names":["define","app","ModalTransferView","CardTemplate","Backbone","View","extend","events","click .action-lease","click","click .action-bill","template","_","initialize","options","this","on","render","data","model","toJSON","$el","html","bill","prettyMoney","utils","handleAction","e","get","viewBill","showTransferModal","contains","target","tagName","id","path","router","getPath","navigate","trigger","viewLease","amount","mySplit","split","my_id","session","user","modal","action","eventName","context"],"mappings":"AAIAA,QACE,MACA,gCACA,wCAEF,SAASC,EAAKC,EAAmBC,GAE/B,MAAOC,UAASC,KAAKC,QAEnBC,QACEC,sBAAuB,YACvBC,MAAS,WAETC,qBAAsB,gBAGxBC,SAAUC,EAAED,SAASR,GAErBU,WAAY,SAASC,GACnBF,EAAEN,OAAOS,KAAMD,GAEfC,KAAKC,GAAG,gBAAiBD,KAAKE,OAAQF,MACtCA,KAAKE,UAGPA,OAAQ,WACN,GAAIC,GAAOH,KAAKI,MAAMC,QAOtB,OALAL,MAAKM,IAAIC,KAAKP,KAAKJ,UACjBY,KAAML,EACNM,YAAavB,EAAIwB,MAAMD,eAGlBT,MAGTW,aAAc,SAASC,GACY,SAA7BZ,KAAKI,MAAMS,IAAI,UACjBb,KAAKc,WAELd,KAAKe,qBAITD,SAAU,SAASF,GACjB,IAAIA,KAAM,IAAK,UAAUI,SAASJ,EAAEK,OAAOC,SAA3C,CACA,GAAIC,GAAKnB,KAAKI,MAAMS,IAAI,OACpBO,EAAOlC,EAAImC,OAAOC,SACtBpC,GAAImC,OAAOE,SAASH,EAAO,IAAMD,GAAMK,SAAS,MAGlDC,UAAW,SAASb,GAClB,GAAIO,GAAKnB,KAAKI,MAAMS,IAAI,YACxB3B,GAAImC,OAAOE,SAAS,aAAeJ,GAAMK,SAAS,KAGpDT,kBAAmB,WACjB,GAAIW,EAEJ,IAA+B,YAA3B1B,KAAKI,MAAMS,IAAI,QAAuB,CACxC,GAEIc,GAFAC,EAAQ5B,KAAKI,MAAMS,IAAI,eACvBgB,EAAQ3C,EAAI4C,QAAQC,KAAKZ,EAEzBS,KAAOD,EAAUC,EAAMC,IAC3BH,EAASC,MAETD,GAAS1B,KAAKI,MAAMS,IAAI,QAI1Bb,MAAKgC,MAAQ,GAAI7C,IACf8C,OAAQ,SACR7B,MAAOJ,KAAKI,MACZ8B,UAAW,gBACXC,QAASnC,KACT0B,OAAQA","file":"bill_large.js","sourcesContent":["/**\n * cards/bill_large.js\n */\n\ndefine([\n  'app',\n  'view/modals/ModalTransferView',\n  'text!templates/cards/bill_large.html',\n],\nfunction(app, ModalTransferView, CardTemplate) {\n\n  return Backbone.View.extend({\n\n    events: {\n      'click .action-lease': 'viewLease',\n      'click': 'viewBill',\n      \n      'click .action-bill': 'handleAction'\n    },\n\n    template: _.template(CardTemplate),\n\n    initialize: function(options) {\n      _.extend(this, options);\n\n      this.on('transferAdded', this.render, this);\n      this.render();\n    },\n\n    render: function() {\n      var data = this.model.toJSON();\n\n      this.$el.html(this.template({ \n        bill: data,\n        prettyMoney: app.utils.prettyMoney\n      }));\n\n      return this;\n    },\n\n    handleAction: function(e) {\n      if (this.model.get('status') === 'paid') {\n        this.viewBill();\n      } else {\n        this.showTransferModal();\n      }\n    },\n\n    viewBill: function(e) {\n      if (e && ['A', 'FOOTER'].contains(e.target.tagName)) return;\n      var id = this.model.get('_id');\n      var path = app.router.getPath();\n      app.router.navigate(path + '/' + id, { trigger: true });\n    },\n\n    viewLease: function(e) {\n      var id = this.model.get('lease._id');\n      app.router.navigate('/myleases/' + id, { trigger: true });\n    },\n\n    showTransferModal: function() {\n      var amount;\n\n      if (this.model.get('type') === 'monthly') {\n        var split = this.model.get('lease.split');\n        var my_id = app.session.user.id;\n        var mySplit;\n        if (split) mySplit = split[my_id];\n        amount = mySplit;\n      } else {\n        amount = this.model.get('total');\n      }\n      \n\n      this.modal = new ModalTransferView({\n        action: 'submit',\n        model: this.model,\n        eventName: 'transferAdded',\n        context: this,\n        amount: amount\n      });\n    }\n\n  });\n});"]}