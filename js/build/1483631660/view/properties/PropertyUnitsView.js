define(["app","collection/leases/LeasesCollection","collection/properties/PropertiesCollection","collection/properties/UnitsCollection","text!templates/properties/property_units.html"],function(e,t,r,i,n){return Backbone.View.extend({className:"property-units",events:{"change select.properties":"propertyChange","change select.units":"unitChange"},template:_.template(n),verifyCollection:function(e){return!(e.length<1)},renderError:function(e){this.context.renderError("It looks like you don't have any "+e+", you need to have a property, unit, and active lease before you can create a bill.")},initialize:function(e){e&&_.extend(this,e);var t=this;this.properties=new r,this.properties.fetch().then(function(){return t.verifyCollection(t.properties)?(t.selected_property=t.selected_property||t.properties.first().get("_id"),t.units=new i(null,{parentModelId:t.selected_property}),void t.units.fetch().then(function(){return t.verifyCollection(t.units)?void t.render():t.renderError("units")})):t.renderError("properties")})},render:function(){return this.properties=this.filterProperties(),this.activeOnly&&(this.units=this.filterUnits()),this.$el.html(this.template({selected_property:this.selected_property,selected_unit:this.selected_unit,properties:this.properties.toJSON(),units:this.units.toJSON()})),this.$el.find(".chosen").chosen({width:"100%"}),this.delegateEvents(),this.context.trigger("addressChanged"),this},filterProperties:function(){var e=this.properties.filter(function(e){var t=e.get("units");return t&&0!==t.length});return new r(e)},filterUnits:function(){var e=this.units.filter(function(e){var r=!0,i=e.get("leases");0===i.length&&(r=!1);var n=!1;return i=new t(i),i.each(function(e){e.active&&(n=!0)}),n||(r=!1),r});return new i(e)},propertyChange:function(){var e=this,t=this.$el.find("select.properties").val();this.selected_property=t,this.units.reset(),this.units=new i(null,{parentModelId:t}),this.units.fetch().success(function(){e.render()})},unitChange:function(){this.context.trigger("addressChanged")}})});
//# sourceMappingURL=PropertyUnitsView.js.map
