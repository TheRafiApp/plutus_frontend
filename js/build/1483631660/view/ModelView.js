define(["app","text!templates/headers/header-tertiary-model.html"],function(e,t){return Backbone.View.extend(_.extend({},Backbone.Events,{className:"model-view",events:{"click .action-edit":"toggleEdit","click .action-cancel":"cancelEdit","click .action-save":"promptSave","click .action-delete":"promptDelete","click .action-back":"hideTertiary","click .action-close":"hideTertiary"},template_container:_.template(t),initialize:function(t){_.extend(this,t);e.router.getRoute();this.template=this.context.template;this.model;this.model=this.context.model,this.render(),Backbone.Validation.bind(this)},render:function(){this.on("confirmSave",this.saveModel,this),this.on("confirmDelete",this.deleteModel,this);var t=this.model.toJSON(),i={model:this.model.display_name()};return this.$el.html(this.template_container({header:i,options:this.options})),this.$el.find(".scroll-y").html(this.template({model:t})),this.$el.find('input[name="phone_pretty"]').mask("(000) 000-0000"),$('.row[data-id="'+e.views.currentView.selected+'"]').addClass("selected"),$(".tertiary").removeClass("loading"),this},toggleEdit:function(){if(this.options.edit){var e=this.$el.find(".action-edit"),t=e.parent().parent(),i=this.$el.find("form.form-model");i.hasClass("editing")?(t.removeClass("editing"),i.removeClass("editing"),i.find("input").prop("disabled",!0)):(t.addClass("editing"),i.addClass("editing"),i.find("input").prop("disabled",!1))}},cancelEdit:function(){this.options.edit&&this.render()},promptSave:function(){if(!e.utils.validate(this))return!1;var t=this.model.display_name(),i="You have made changes to "+t+". Are you sure you want to save your changes?";e.controls.modalConfirm(i,"confirmSave",this)},promptDelete:function(){var t=this.model.display_name(),i="Are you sure you want to delete "+t+"?";e.controls.modalConfirm(i,"confirmDelete",this)},saveModel:function(){var t=$(".form-model"),i=t.serializeArray(),o={};$.map(i,function(e){o[e.name]=e.value}),this.model.save(o).success(function(){var t=e.router.getRoute();e.router.navigate(t,{trigger:!0})}).error(function(){e.router.navigate(route,{trigger:!0}),e.alerts.success("No changes were made.")})},deleteModel:function(t,i){var o=this,n=$.Deferred();return this.model.destroy().then(function(){var t=e.router.getRoute();e.router.navigate(t,{trigger:!0}),n.resolve()}).fail(function(t){i||e.controls.handleError(t,null,o,"deleteModel"),n.reject(t)}),n},hideTertiary:function(){e.views.modelView&&e.controls.hideTertiary()}}))});
//# sourceMappingURL=ModelView.js.map
