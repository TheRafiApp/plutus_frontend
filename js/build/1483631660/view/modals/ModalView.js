define(["app","text!templates/modals/modal.html"],function(e,t){return Backbone.View.extend({modalEvents:{keyup:"keyControl","click .action-confirm":"confirm","click .action-cancel":"closeModal","click .overlay":"closeModal"},template_container:_.template(t),actions:{confirm:!0,cancel:!0},messages:{success:"Your changes have been saved",error:"Your changes could not be saved"},keyControl:function(t){if(27===t.which)this.closeModal();else if(13===t.which){var i=e.utils.getFocused();if(i.parentNode.className.contains("actions"))return;if(i.className.contains("no-submit"))return;this.confirm(t)}},attachEvents:function(){var e=_.extend(this.modalEvents,this.events);this.delegateEvents(e),this.listening=!0},renderModalView:function(t){t&&_.extend(this,t),e.views.appView&&e.views.appView.trigger("modalOpened"),e.views.modalView=this,this.renderContainer()},renderContainer:function(){var e="function"==typeof this.title?this.title():this.title;return this.$el.html(this.template_container({title:e,actions:this.actions})),this.tabs&&this.renderTabs(),this.listening||this.attachEvents(),this.render(),this},renderTabs:function(){var e=0,t=$('<ul class="tabs">');_.each(this.tabs,function(i,s,n){var a=$("<li>"),o=$("<a>",{href:"#","data-tab":s}).html(i);0===e++&&o.addClass("active"),a.append(o),t.append(a)}),this.$el.find(".content").prepend(t)},ready:function(t){this.model&&Backbone.Validation.bind(this),this.$el.find(".form-model").html(this.template(t)),$(".modal-container").html(this.$el).addClass("visible"),e.utils.prepInputs(this)},closeModal:function(t){$(".modal-container").removeClass("visible"),this.close(),this.context.trigger("modalClosed"),e.views.appView&&e.views.appView.trigger("modalClosed")},constructData:function(){var t=this.$el.find("form"),i=t.serializeObject();return e.schema.process(i,this.model)},confirm:function(t){if(console.trace(t),!t||!$(t.currentTarget).hasClass("disabled")){var i=this,s=this.constructData();if(!e.utils.validate(this,s))return!1;console.log(s),e.controls.loadLock(!0),this.model.save(s).always(function(){e.controls.loadLock(!1)}).then(function(){i.context.trigger(i.eventName),i.closeModal(),e.alerts.success(i.messages.success)}).fail(function(e){i.handleError(e)})}},handleError:function(t){return e.controls.handleError(t)}})});
//# sourceMappingURL=ModalView.js.map
