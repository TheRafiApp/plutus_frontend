define(["model/account/AccountModel","text!templates/modals/modal-confirm.html"],function(e,t){return Backbone.View.extend({events:{"click .action-confirm":"confirm","click .action-cancel":"closeModal","click .overlay":"closeModal",keyup:"keyControl"},template:_.template(t),keyControl:function(e){if(27===e.which)this.closeModal();else if(13===e.which){if(this.app.utils.getFocused().parentNode.className.contains("actions"))return;this.confirm()}},initialize:function(e){e&&_.extend(this,e),this.model=this.context.model,this.app.views.appView.trigger("modalOpened"),this.app.views.modalView=this,this.render()},render:function(){var e={message:this.message},t=this,i=Object.keys(this.data).map(function(e,i,s){if("tenant"!==e)return e+": "+t.data[e].length}).join(", ");return this.$el.html(this.template({warning:this.warning(),data_summary:i,dialogue:e})),$(".modal-container").html(this.$el).addClass("visible"),this.$el.find(".password").focus(),this.delegateEvents(),this},warning:function(){var e;return this.data.tenant?(e="Deleting this tenant will remove them from their lease",this.data.leases.length>1&&(e+="s"),e+="!"):e="Deleting this "+this.model.name+" will also delete its data!",e},closeModal:function(){$(".modal-container").removeClass("visible"),this.app.views.appView.trigger("modalClosed"),this.close()},refuse:function(){this.app.controls.modalShake(this)},confirm:function(e){var t=this,i=this.$el.find("#confirm"),s=i.is(":checked");s||this.app.controls.fieldError({element:i,type:"error",error:"Please confirm"});var o=this.$el.find(".password"),n=o.val();return n||this.app.controls.fieldError({element:o,type:"error",error:"Please enter your password"}),s&&n?(this.app.session.tokens.pass=n,void this.context[this.method](null,!0).then(function(){t.context.trigger("hardConfirm"),t.closeModal()}).fail(function(e){t.refuse(),e.responseJSON&&"incorrect_password"==e.responseJSON.error&&t.app.controls.fieldError({element:o,type:"error",error:"Incorrect password"})})):void this.refuse()}})});
//# sourceMappingURL=ModalConfirmView.js.map
