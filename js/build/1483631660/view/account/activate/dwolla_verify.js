define(["app","model/account/DwollaAccountModel","model/companies/DwollaBusinessModel","text!templates/account/activate/dwolla_verify.html","view/modals/ModalTermsView"],function(e,t,i,a,s){return Backbone.View.extend({className:"dwolla wide",template:_.template(a),events:{"blur .zip":"zipChange","keyup .zip":"keyupZip","click .action-next":"confirm","change #agree":"agree"},initialize:function(e){e&&_.extend(this,e),this.dwolla_data=this.parentView.dwolla_data,this.user=this.parentView.user,this.on("declineTerms",this.decline,this);var a=this.dwolla_data.type;"personal"===a?this.model=new t:"business"===a&&(this.model=new i),Backbone.Validation.bind(this),this.render()},render:function(){return this.$el.html(this.template({type:this.dwolla_data.type,user:this.user.toJSON(),logo:e.templates.logo()})),e.utils.prepInputs(this),this.$el.find('input[name="ein"]').mask("00-0000000"),this},keyupZip:function(e){13===e.which&&this.zipChange(e)},zipChange:function(t){var i=t.currentTarget.value;5!==i.length?e.controls.fieldError({element:t.currentTarget,error:"Please enter a valid zip code"}):this.getAddressData(i)},getAddressData:function(t){var i=this,a=e.utils.request({path:"https://api.zippopotam.us/us/"+t,method:"GET",noheaders:!0});a.then(function(e){i.updateAddress(e.places[0])})},updateAddress:function(e){var t=this.$el.find(".city, .state"),i=[e["place name"],e["state abbreviation"]];$.each(t,function(e,t){$(t).prop("disabled",!1).val(i[e])})},constructData:function(){var e=this.$el.find("form"),t=e.serializeObject();return t},confirm:function(){var t=this,i=this.constructData(),a=!1,s=this.$el.find("#agree"),n=s.is(":checked");if(n||(e.controls.fieldError({element:s,error:"Please agree to the terms of use"}),a=!0),e.utils.validate(this,i)||(a=!0),!a){var o=e.schema.process(i,this.model);o.email=this.user.get("email"),o.type=this.dwolla_data.type,"business"===o.type&&(o.businessClassification="9ed492ab-7d6f-11e3-9907-5404a6144203"),e.controls.loadLock(),this.model.save(o).success(function(i){t.parentView.user.set(i),e.controls.loadLock(),t.parentView.next()}).fail(function(t){e.controls.handleError(t)})}}})});
//# sourceMappingURL=dwolla_verify.js.map
