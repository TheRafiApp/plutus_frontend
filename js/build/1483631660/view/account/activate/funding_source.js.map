{"version":3,"sources":["view/account/activate/funding_source.js"],"names":["define","app","Template","Backbone","View","extend","className","template","_","events","click .action-select","click .action-next","initialize","options","self","this","session","getFundingSources","then","response","funding_sources","render","fail","error","console","warn","always","$el","removeClass","log","collection","filter","funding_source","name","html","selectChoice","e","find","$","currentTarget","addClass","next","length","alerts","data","attr","setFundingSource","parentView"],"mappings":"AAIAA,QACE,MAEA,uDAEF,SAASC,EAAKC,GAEZ,MAAOC,UAASC,KAAKC,QAEnBC,UAAW,wBACXC,SAAUC,EAAED,SAASL,GAErBO,QACEC,uBAAwB,eACxBC,qBAAsB,QAGxBC,WAAY,SAASC,GACnB,GAAIC,GAAOC,IACPF,IAASL,EAAEH,OAAOU,KAAMF,GAI5BZ,EAAIe,QAAQC,oBAAoBC,KAAK,SAASC,GAG5CL,EAAKM,gBAAkBD,EACvBL,EAAKO,WACJC,KAAK,SAASC,GACfC,QAAQC,KAAKF,GACbT,EAAKO,WACJK,OAAO,WACRZ,EAAKa,IAAIC,YAAY,cAIzBP,OAAQ,WAYNG,QAAQK,IAAId,KAAKe,WAEjB,IAAIV,GAAkBL,KAAKK,gBAAgBW,OAAO,SAASC,GACzD,MAA+B,YAAxBA,EAAeC,MAOxB,OAJAlB,MAAKY,IAAIO,KAAKnB,KAAKR,UACjBa,gBAAiBA,KAGZL,MAGToB,aAAc,SAASC,GACrBrB,KAAKY,IAAIU,KAAK,kBAAkBT,YAAY,UAC5CU,EAAEF,EAAEG,eAAeC,SAAS,WAG9BC,KAAM,WACJ,GAAiD,IAA7C1B,KAAKY,IAAIU,KAAK,oBAAoBK,OAEpC,WADAzC,GAAI0C,OAAOpB,MAAM,+BAGnB,IAAIT,GAAOC,KAEP6B,GACFZ,eAAgBjB,KAAKY,IAAIU,KAAK,oBAAoBQ,KAAK,WAMzD5C,GAAIe,QAAQ8B,iBAAiBF,GAAM1B,KAAK,WAEtCJ,EAAKiC,WAAWN,SACfnB,KAAK,SAASC,GACfC,QAAQC,KAAKF","file":"funding_source.js","sourcesContent":["/**\n * account/onboarding/funding_source.js\n */\n\ndefine([\n  'app',\n  // 'collection/account/FundingSourcesCollection',\n  'text!templates/account/activate/funding_source.html',\n],\nfunction(app, Template) {\n\n  return Backbone.View.extend({\n\n    className: 'fundingsource loading',\n    template: _.template(Template),\n\n    events: {\n      'click .action-select': 'selectChoice',\n      'click .action-next': 'next'\n    },\n\n    initialize: function(options) {\n      var self = this;\n      if (options) _.extend(this, options);\n\n      // this.collection = new FundingSourcesCollection();\n      \n      app.session.getFundingSources().then(function(response) {\n        // console.warn(response)\n      // this.collection.fetch().then(function(response) {\n        self.funding_sources = response;\n        self.render();\n      }).fail(function(error) {\n        console.warn(error);\n        self.render();\n      }).always(function() {\n        self.$el.removeClass('loading');\n      });\n    },\n\n    render: function() {\n      var self = this;\n\n      // console.log(this.collection)\n\n      // if (this.step.value) {\n      //   this.parentView.next();\n      //   return;\n      // }\n      \n      // this.funding_sources = this.collection.toJSON();\n\n      console.log(this.collection)\n\n      var funding_sources = this.funding_sources.filter(function(funding_source) {\n        return funding_source.name !== 'Balance';\n      });\n\n      this.$el.html(this.template({\n        funding_sources: funding_sources\n      }));\n\n      return this;\n    },\n\n    selectChoice: function(e) {\n      this.$el.find('.action-select').removeClass('active');\n      $(e.currentTarget).addClass('active');\n    },\n\n    next: function() {\n      if (this.$el.find('.choices .active').length !== 1) {\n        app.alerts.error('Please select a bank account');\n        return;\n      }\n      var self = this;\n\n      var data = {\n        funding_source: this.$el.find('.choices .active').attr('data-id')\n      };\n      \n      // var id = this.$el.find('.choices .active').attr('data-id');\n      // var model = this.collection.get(id);\n\n      app.session.setFundingSource(data).then(function() {\n      // model.save().then(function() {\n        self.parentView.next();\n      }).fail(function(error) {\n        console.warn(error);\n      });\n    }\n\n  });\n});"]}