define(["app","text!templates/account/activate/dwolla_iav.html","https://cdn.dwolla.com/1/dwolla.js"],function(e,t){return Backbone.View.extend({className:"dwolla",template:_.template(t),events:{"click .action-next":"nextStep"},initialize:function(t){t&&_.extend(this,t);var i=this;this.user=this.parentView.user;var n;n=e.session.get("logged_in")?"account/iav":this.user.get("role")+"s/activate/dwolla",e.utils.request({path:n,method:"GET"}).then(function(e){var t=i.user.get("dwolla")||{};t.iav_token=e,i.parentView.user.set({dwolla:t}),i.render()}).fail(function(t){e.controls.handleError(t)})},render:function(){var t=this;if(this.$el.html(this.template({logo:e.templates.logo()})),this.step.dwolla_account&&this.step.dwolla_account.primary_funding_source)return this.renderAllSet();var i=this.user.get("dwolla.iav_token");return dwolla.configure(e.config.dwolla_env),dwolla.iav.start(i,{container:"iav-container",stylesheets:["https://fonts.googleapis.com/css?family=Roboto",e.url.base_url+"css/dwolla_style.css"],microDeposits:!1,fallbackToMicroDeposits:!0},function(i,n){if(n){var s,a={id:n._links["funding-source"].href.split("funding-sources/")[1],status:n._links["verify-micro-deposits"]?"unverified":"verified"};s=e.session.get("logged_in")?"account/funding_sources":t.user.get("role")+"s/activate/funding_sources",e.utils.request({path:s,method:"POST",data:a}).then(function(e){t.parentView.user.set(e),t.parentView.next()})}else i&&e.controls.handleError(i)}),this.$el.find("iframe").one("load",$.proxy(this.iframeLoaded,this)),this},iframeLoaded:function(){this.$el.find(".overlay.loading").remove()},renderAllSet:function(){var e='<div class="form-model"><h1>Bank Account</h1>';e+='<div class="all-set">You\'ve already linked your bank account!</div>',e+='<div class="pad-20"><a href="#" class="btn action-next">Next</a></div></div>',this.$el.find("#iav-container").html(e)},nextStep:function(){this.parentView.next()}})});
//# sourceMappingURL=dwolla_iav.js.map
