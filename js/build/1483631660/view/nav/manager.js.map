{"version":3,"sources":["view/nav/manager.js"],"names":["define","app","ModalPropertyView","ModalInviteView","NavTemplate","Backbone","View","extend","template","_","events","mousedown .action-add-manager","mousedown .action-add-tenant","mousedown .action-add-landlord","mousedown .action-add-property","click .action-logout","click .action-toggle-sub","click .action-quick-add","blur .action-toggle-sub","blur .action-quick-add","mousedown .switches .tooltip a","initialize","router","on","route","params","this","update","managerAdded","tenantAdded","landlordAdded","propertyAdded","render","currentRoute","getRoute","split","$el","find","removeClass","addClass","html","logo","templates","logout","controls","toggleQuickAdd","$tooltip","$btn","hasClass","focus","toggleSub","e","$","currentTarget","next","type","quickLink","preventDefault","$target","url","attr","navigate","trigger","replace","addManager","modal","action","role","eventName","context","addTenant","addLandlord","addProperty","adminAdded"],"mappings":"AAIAA,QACE,MACA,gCACA,8BACA,mCAEF,SAASC,EAAKC,EAAmBC,EAAiBC,GAEhD,MAAOC,UAASC,KAAKC,QAEnBC,SAAUC,EAAED,SAASJ,GAErBM,QACEC,gCAAiC,aACjCC,+BAAgC,YAChCC,iCAAkC,cAClCC,iCAAkC,cAClCC,uBAAwB,SACxBC,2BAA4B,YAC5BC,0BAA2B,iBAC3BC,0BAA2B,YAC3BC,yBAA0B,iBAC1BC,iCAAkC,aAGpCC,WAAY,WAmBV,MAdApB,GAAIqB,OAAOC,GAAG,QAAS,SAASC,EAAOC,GACrCC,KAAKC,UACJD,MAEHA,KAAKH,IACHK,aAAgBF,KAAKE,aACrBC,YAAeH,KAAKG,YACpBC,cAAiBJ,KAAKI,cACtBC,cAAiBL,KAAKK,gBAGxBL,KAAKM,SACLN,KAAKC,SAEED,MAGTC,OAAQ,WACN,GAAIM,GAAehC,EAAIqB,OAAOY,WAAWC,MAAM,KAAK,EACpDT,MAAKU,IAAIC,KAAK,WAAWC,YAAY,UACrCZ,KAAKU,IAAIC,KAAK,YAAcJ,EAAe,MAAMM,SAAS,WAG5DP,OAAQ,WAIN,MAHAN,MAAKU,IAAII,KAAKd,KAAKlB,UACjBiC,KAAMxC,EAAIyC,UAAUD,UAEff,MAGTiB,OAAQ,WACN1C,EAAI2C,SAASD,UAGfE,eAAgB,WACd,GAAIC,GAAWpB,KAAKU,IAAIC,KAAK,4BACzBU,EAAOrB,KAAKU,IAAIC,KAAK,oBACrBS,GAASE,SAAS,QACpBF,EAASR,YAAY,SAErBQ,EAASP,SAAS,QAClBQ,EAAKE,UAITC,UAAW,SAASC,GAClB,GAAIJ,GAAOK,EAAED,EAAEE,eACXP,EAAWC,EAAKO,KAAK,WAErBR,GAASE,SAAS,QACpBF,EAASR,YAAY,QAEP,SAAVa,EAAEI,OACJT,EAASP,SAAS,QAClBQ,EAAKE,UAKXO,UAAW,SAASL,GAClBA,EAAEM,gBACF,IAAIC,GAAUN,EAAED,EAAEE,eACdM,EAAMD,EAAQE,KAAK,OAEX,OAARD,GACJ1D,EAAIqB,OAAOuC,SAASF,GAAOG,SAAS,EAAMC,SAAS,KAGrDC,WAAY,WAEVtC,KAAKuC,MAAQ,GAAI9D,IACf+D,OAAQ,SACRC,KAAM,UACNC,UAAW,eACXC,QAAS3C,QAIb4C,UAAW,WAET5C,KAAKuC,MAAQ,GAAI9D,IACf+D,OAAQ,SACRC,KAAM,SACNC,UAAW,cACXC,QAAS3C,QAIb6C,YAAa,WAEX7C,KAAKuC,MAAQ,GAAI9D,IACf+D,OAAQ,SACRC,KAAM,WACNC,UAAW,gBACXC,QAAS3C,QAIb8C,YAAa,WAEX9C,KAAKuC,MAAQ,GAAI/D,IACfgE,OAAQ,MACRE,UAAW,gBACXC,QAAS3C,QAeb+C,WAAY,WACVxE,EAAIqB,OAAOuC,SAAS,WAAaC,SAAS,KAG5ClC,aAAc,WACZ3B,EAAIqB,OAAOuC,SAAS,aAAeC,SAAS,KAG9CjC,YAAa,WACX5B,EAAIqB,OAAOuC,SAAS,YAAcC,SAAS,KAG7ChC,cAAe,WACb7B,EAAIqB,OAAOuC,SAAS,cAAgBC,SAAS,KAG/C/B,cAAe,WACb9B,EAAIqB,OAAOuC,SAAS,eAAiBC,SAAS","file":"manager.js","sourcesContent":["/**\n * nav/manager.js\n */\n\ndefine([\n  'app',\n  'view/modals/ModalPropertyView',\n  'view/modals/ModalInviteView',\n  'text!templates/nav/manager.html'\n],\nfunction(app, ModalPropertyView, ModalInviteView, NavTemplate) {\n\n  return Backbone.View.extend({\n\n    template: _.template(NavTemplate),\n\n    events: {\n      'mousedown .action-add-manager': 'addManager',\n      'mousedown .action-add-tenant': 'addTenant',\n      'mousedown .action-add-landlord': 'addLandlord',\n      'mousedown .action-add-property': 'addProperty',\n      'click .action-logout': 'logout',\n      'click .action-toggle-sub': 'toggleSub',\n      'click .action-quick-add': 'toggleQuickAdd',\n      'blur .action-toggle-sub': 'toggleSub',\n      'blur .action-quick-add': 'toggleQuickAdd',\n      'mousedown .switches .tooltip a': 'quickLink'\n    },\n\n    initialize: function() {\n      var self = this;\n      // this.role = app.session.get('user_role');\n\n      // events\n      app.router.on('route', function(route, params) {\n        this.update();\n      }, this);\n\n      this.on({\n        'managerAdded': this.managerAdded,\n        'tenantAdded': this.tenantAdded,\n        'landlordAdded': this.landlordAdded,\n        'propertyAdded': this.propertyAdded,\n      });\n\n      this.render();\n      this.update();\n\n      return this;\n    },\n\n    update: function() {\n      var currentRoute = app.router.getRoute().split('?')[0];\n      this.$el.find('ul li a').removeClass('active');\n      this.$el.find('a[href=\"/' + currentRoute + '\"]').addClass('active');\n    },\n\n    render: function() {\n      this.$el.html(this.template({ \n        logo: app.templates.logo()\n      }));\n      return this;\n    },\n\n    logout: function() {\n      app.controls.logout();\n    },\n\n    toggleQuickAdd: function() {\n      var $tooltip = this.$el.find('.footer-actions .tooltip');\n      var $btn = this.$el.find('.action-quick-add');\n      if ($tooltip.hasClass('open')) {\n        $tooltip.removeClass('open');\n      } else {\n        $tooltip.addClass('open');\n        $btn.focus();\n      }\n    },\n\n    toggleSub: function(e) {\n      var $btn = $(e.currentTarget);\n      var $tooltip = $btn.next('.tooltip');\n\n      if ($tooltip.hasClass('open')) {\n        $tooltip.removeClass('open');\n      } else {\n        if (e.type == 'click') {\n          $tooltip.addClass('open');\n          $btn.focus();\n        }\n      }\n    },\n    \n    quickLink: function(e) { // fix for blur event listener bug\n      e.preventDefault();\n      var $target = $(e.currentTarget);\n      var url = $target.attr('href');\n\n      if (url === '#') return;\n      app.router.navigate(url, { trigger: true, replace: false });\n    },\n\n    addManager: function() {\n      // this.modelName = 'manager';\n      this.modal = new ModalInviteView({\n        action: 'invite',\n        role: 'manager',\n        eventName: 'managerAdded',\n        context: this\n      });\n    },\n\n    addTenant: function() {\n      // this.modelName = 'tenant';\n      this.modal = new ModalInviteView({\n        action: 'invite',\n        role: 'tenant',\n        eventName: 'tenantAdded',\n        context: this\n      });\n    },\n\n    addLandlord: function() {\n      // this.modelName = 'landlord';\n      this.modal = new ModalInviteView({\n        action: 'invite',\n        role: 'landlord',\n        eventName: 'landlordAdded',\n        context: this\n      });\n    },\n\n    addProperty: function() {\n      // this.modelName = 'property';\n      this.modal = new ModalPropertyView({\n        action: 'add',\n        eventName: 'propertyAdded',\n        context: this\n      });\n    },\n\n    // addTransfer: function() {\n\n    //   var ModalTransferView = this.TransferModal;\n    //   this.modal = new ModalTransferView({\n    //     action: 'add',\n    //     type: 'electronic',\n    //     eventName: 'transferAdded',\n    //     context: this\n    //   });\n    // },\n\n    adminAdded: function() {\n      app.router.navigate('/admins', { trigger: true });\n    },\n\n    managerAdded: function() {\n      app.router.navigate('/managers', { trigger: true });\n    },\n\n    tenantAdded: function() {\n      app.router.navigate('/tenants', { trigger: true });\n    },\n\n    landlordAdded: function() {\n      app.router.navigate('/landlords', { trigger: true });\n    },\n\n    propertyAdded: function() {\n      app.router.navigate('/properties', { trigger: true });\n    },\n\n  });\n});"]}