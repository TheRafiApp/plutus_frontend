{"version":3,"sources":["view/nav/superadmin.js"],"names":["define","app","ModalCompanyView","ModalPropertyView","ModalInviteView","NavTemplate","Backbone","View","extend","template","_","events","mousedown .action-add-company","mousedown .action-add-admin","mousedown .action-add-manager","mousedown .action-add-tenant","mousedown .action-add-landlord","mousedown .action-add-property","click .action-logout","click .action-toggle-sub","click .action-quick-add","blur .action-toggle-sub","blur .action-quick-add","mousedown .switches .tooltip a","initialize","router","on","route","params","this","update","companyAdded","superAdminAdded","adminAdded","managerAdded","tenantAdded","landlordAdded","propertyAdded","render","currentRoute","getRoute","split","$el","find","removeClass","addClass","html","logo","templates","logout","controls","toggleQuickAdd","$tooltip","$btn","hasClass","focus","toggleSub","e","$","currentTarget","next","type","quickLink","preventDefault","$target","url","attr","navigate","trigger","replace","addCompany","session","isSuperAdmin","modal","action","context","eventName","addAdmin","role","addManager","addTenant","addLandlord","addProperty","addTransfer","ModalTransferView","TransferModal"],"mappings":"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","file":"superadmin.js","sourcesContent":["/**\n * nav/superadmin.js\n */\n\ndefine([\n  'app',\n  'view/modals/ModalCompanyView',\n  // 'view/modals/ModalAdminView',\n  'view/modals/ModalPropertyView',\n  'view/modals/ModalInviteView',\n  'text!templates/nav/superadmin.html'\n],\nfunction(app, ModalCompanyView, ModalPropertyView, ModalInviteView, NavTemplate) {\n\n  return Backbone.View.extend({\n\n    // tagName: 'nav',\n    // className: 'layer primary',\n\n    template: _.template(NavTemplate),\n\n    events: {\n      'mousedown .action-add-company': 'addCompany',\n      'mousedown .action-add-admin': 'addAdmin',\n      'mousedown .action-add-manager': 'addManager',\n      'mousedown .action-add-tenant': 'addTenant',\n      'mousedown .action-add-landlord': 'addLandlord',\n      'mousedown .action-add-property': 'addProperty',\n      'click .action-logout': 'logout',\n      'click .action-toggle-sub': 'toggleSub',\n      'click .action-quick-add': 'toggleQuickAdd',\n      'blur .action-toggle-sub': 'toggleSub',\n      'blur .action-quick-add': 'toggleQuickAdd',\n      'mousedown .switches .tooltip a': 'quickLink'\n    },\n\n    initialize: function() {\n      var self = this;\n      // this.role = app.session.get('user_role');\n\n      // events\n      app.router.on('route', function(route, params) {\n        this.update();\n      }, this);\n\n      this.on({\n        'companyAdded': this.companyAdded,\n        'superAdminAdded': this.superAdminAdded,\n        'adminAdded': this.adminAdded,\n        'managerAdded': this.managerAdded,\n        'tenantAdded': this.tenantAdded,\n        'landlordAdded': this.landlordAdded,\n        'propertyAdded': this.propertyAdded,\n      });\n\n      this.update();\n      this.render();\n\n      return this;\n    },\n\n    update: function() {\n      var currentRoute = app.router.getRoute().split('?')[0];\n      this.$el.find('ul li a').removeClass('active');\n      this.$el.find('a[href=\"/' + currentRoute + '\"]').addClass('active');\n    },\n\n    render: function() {\n      this.$el.html(this.template({ \n        logo: app.templates.logo()\n      }));\n      return this;\n    },\n\n    logout: function() {\n      app.controls.logout();\n    },\n\n    toggleQuickAdd: function() {\n      var $tooltip = this.$el.find('.footer-actions .tooltip');\n      var $btn = this.$el.find('.action-quick-add');\n      if ($tooltip.hasClass('open')) {\n        $tooltip.removeClass('open');\n      } else {\n        $tooltip.addClass('open');\n        $btn.focus();\n      }\n    },\n\n    toggleSub: function(e) {\n      var $btn = $(e.currentTarget);\n      var $tooltip = $btn.next('.tooltip');\n\n      if ($tooltip.hasClass('open')) {\n        $tooltip.removeClass('open');\n      } else {\n        if (e.type == 'click') {\n          $tooltip.addClass('open');\n          $btn.focus();\n        }\n      }\n    },\n    \n    quickLink: function(e) { // fix for blur event listener bug\n      e.preventDefault();\n      var $target = $(e.currentTarget);\n      var url = $target.attr('href');\n\n      if (url === '#') return;\n      app.router.navigate(url, { trigger: true, replace: false });\n    },\n\n    addCompany: function() {\n      if (!app.session.isSuperAdmin()) return false;\n\n      this.modal = new ModalCompanyView({\n        action: 'add',\n        context: this,\n        eventName: 'companyAdded',\n      });\n    },\n\n    addAdmin: function() {\n      if (!app.session.isSuperAdmin()) return false;\n\n      this.modal = new ModalInviteView({\n        action: 'invite',\n        role: 'admin',\n        eventName: 'adminAdded',\n        context: this\n      });\n    },\n\n    addManager: function() {\n      // this.modelName = 'manager';\n      this.modal = new ModalInviteView({\n        action: 'invite',\n        role: 'manager',\n        eventName: 'managerAdded',\n        context: this\n      });\n    },\n\n    addTenant: function() {\n      // this.modelName = 'tenant';\n      this.modal = new ModalInviteView({\n        action: 'invite',\n        role: 'tenant',\n        eventName: 'tenantAdded',\n        context: this\n      });\n    },\n\n    addLandlord: function() {\n      // this.modelName = 'landlord';\n      this.modal = new ModalInviteView({\n        action: 'invite',\n        role: 'landlord',\n        eventName: 'landlordAdded',\n        context: this\n      });\n    },\n\n    addProperty: function() {\n      // this.modelName = 'property';\n      this.modal = new ModalPropertyView({\n        action: 'add',\n        eventName: 'propertyAdded',\n        context: this\n      });\n    },\n\n    addTransfer: function() {\n      // this.modelName = 'transfer';\n\n      var ModalTransferView = this.TransferModal;\n      this.modal = new ModalTransferView({\n        action: 'add',\n        type: 'electronic',\n        eventName: 'transferAdded',\n        context: this\n      });\n    },\n\n    companyAdded: function() {\n      app.router.navigate('/companies', { trigger: true });\n    },\n\n    superAdminAdded: function() {\n      app.router.navigate('/superadmins', { trigger: true });\n    },\n\n    adminAdded: function() {\n      app.router.navigate('/admins', { trigger: true });\n    },\n\n    managerAdded: function() {\n      app.router.navigate('/managers', { trigger: true });\n    },\n\n    tenantAdded: function() {\n      app.router.navigate('/tenants', { trigger: true });\n    },\n\n    landlordAdded: function() {\n      app.router.navigate('/landlords', { trigger: true });\n    },\n\n    propertyAdded: function() {\n      app.router.navigate('/properties', { trigger: true });\n    },\n\n  });\n});"]}