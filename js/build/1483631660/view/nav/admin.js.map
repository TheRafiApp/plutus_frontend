{"version":3,"sources":["view/nav/admin.js"],"names":["define","app","ModalPropertyView","ModalInviteView","NavTemplate","Backbone","View","extend","template","_","events","mousedown .action-add-admin","mousedown .action-add-manager","mousedown .action-add-tenant","mousedown .action-add-landlord","mousedown .action-add-property","click .action-logout","click .action-toggle-sub","click .action-quick-add","blur .action-toggle-sub","blur .action-quick-add","mousedown .switches .tooltip a","initialize","router","on","route","params","this","update","adminAdded","managerAdded","tenantAdded","landlordAdded","propertyAdded","render","currentRoute","getRoute","split","$el","find","removeClass","addClass","html","logo","templates","logout","controls","toggleQuickAdd","$tooltip","$btn","hasClass","focus","toggleSub","e","$","currentTarget","next","type","quickLink","preventDefault","$target","url","attr","navigate","trigger","replace","addAdmin","modal","action","role","eventName","context","addManager","addTenant","addLandlord","addProperty","addTransfer","ModalTransferView","TransferModal"],"mappings":"AAIAA,QACE,MACA,gCACA,8BACA,iCAEF,SAASC,EAAKC,EAAmBC,EAAiBC,GAEhD,MAAOC,UAASC,KAAKC,QAKnBC,SAAUC,EAAED,SAASJ,GAErBM,QAEEC,8BAA+B,WAC/BC,gCAAiC,aACjCC,+BAAgC,YAChCC,iCAAkC,cAClCC,iCAAkC,cAElCC,uBAAwB,SACxBC,2BAA4B,YAC5BC,0BAA2B,iBAC3BC,0BAA2B,YAC3BC,yBAA0B,iBAC1BC,iCAAkC,aAGpCC,WAAY,WAoBV,MAfArB,GAAIsB,OAAOC,GAAG,QAAS,SAASC,EAAOC,GACrCC,KAAKC,UACJD,MAEHA,KAAKH,IACHK,WAAcF,KAAKE,WACnBC,aAAgBH,KAAKG,aACrBC,YAAeJ,KAAKI,YACpBC,cAAiBL,KAAKK,cACtBC,cAAiBN,KAAKM,gBAGxBN,KAAKC,SACLD,KAAKO,SAEEP,MAGTC,OAAQ,WACN,GAAIO,GAAelC,EAAIsB,OAAOa,WAAWC,MAAM,KAAK,EACpDV,MAAKW,IAAIC,KAAK,WAAWC,YAAY,UACrCb,KAAKW,IAAIC,KAAK,YAAcJ,EAAe,MAAMM,SAAS,WAG5DP,OAAQ,WAIN,MAHAP,MAAKW,IAAII,KAAKf,KAAKnB,UACjBmC,KAAM1C,EAAI2C,UAAUD,UAEfhB,MAGTkB,OAAQ,WACN5C,EAAI6C,SAASD,UAGfE,eAAgB,WACd,GAAIC,GAAWrB,KAAKW,IAAIC,KAAK,4BACzBU,EAAOtB,KAAKW,IAAIC,KAAK,oBACrBS,GAASE,SAAS,QACpBF,EAASR,YAAY,SAErBQ,EAASP,SAAS,QAClBQ,EAAKE,UAITC,UAAW,SAASC,GAClB,GAAIJ,GAAOK,EAAED,EAAEE,eACXP,EAAWC,EAAKO,KAAK,WAErBR,GAASE,SAAS,QACpBF,EAASR,YAAY,QAEP,SAAVa,EAAEI,OACJT,EAASP,SAAS,QAClBQ,EAAKE,UAKXO,UAAW,SAASL,GAClBA,EAAEM,gBACF,IAAIC,GAAUN,EAAED,EAAEE,eACdM,EAAMD,EAAQE,KAAK,OAEX,OAARD,GACJ5D,EAAIsB,OAAOwC,SAASF,GAAOG,SAAS,EAAMC,SAAS,KAGrDC,SAAU,WACRvC,KAAKwC,MAAQ,GAAIhE,IACfiE,OAAQ,SACRC,KAAM,QACNC,UAAW,aACXC,QAAS5C,QAIb6C,WAAY,WAEV7C,KAAKwC,MAAQ,GAAIhE,IACfiE,OAAQ,SACRC,KAAM,UACNC,UAAW,eACXC,QAAS5C,QAIb8C,UAAW,WAET9C,KAAKwC,MAAQ,GAAIhE,IACfiE,OAAQ,SACRC,KAAM,SACNC,UAAW,cACXC,QAAS5C,QAIb+C,YAAa,WAEX/C,KAAKwC,MAAQ,GAAIhE,IACfiE,OAAQ,SACRC,KAAM,WACNC,UAAW,gBACXC,QAAS5C,QAIbgD,YAAa,WAEXhD,KAAKwC,MAAQ,GAAIjE,IACfkE,OAAQ,MACRE,UAAW,gBACXC,QAAS5C,QAIbiD,YAAa,WAGX,GAAIC,GAAoBlD,KAAKmD,aAC7BnD,MAAKwC,MAAQ,GAAIU,IACfT,OAAQ,MACRX,KAAM,aACNa,UAAW,gBACXC,QAAS5C,QAIbE,WAAY,WACV5B,EAAIsB,OAAOwC,SAAS,WAAaC,SAAS,KAG5ClC,aAAc,WACZ7B,EAAIsB,OAAOwC,SAAS,aAAeC,SAAS,KAG9CjC,YAAa,WACX9B,EAAIsB,OAAOwC,SAAS,YAAcC,SAAS,KAG7ChC,cAAe,WACb/B,EAAIsB,OAAOwC,SAAS,cAAgBC,SAAS,KAG/C/B,cAAe,WACbhC,EAAIsB,OAAOwC,SAAS,eAAiBC,SAAS","file":"admin.js","sourcesContent":["/**\n * nav/admin.js\n */\n\ndefine([\n  'app',\n  'view/modals/ModalPropertyView',\n  'view/modals/ModalInviteView',\n  'text!templates/nav/admin.html'\n],\nfunction(app, ModalPropertyView, ModalInviteView, NavTemplate) {\n\n  return Backbone.View.extend({\n\n    // tagName: 'nav',\n    // className: 'layer primary',\n\n    template: _.template(NavTemplate),\n\n    events: {\n      // 'mousedown .action-add-company': 'addCompany',\n      'mousedown .action-add-admin': 'addAdmin',\n      'mousedown .action-add-manager': 'addManager',\n      'mousedown .action-add-tenant': 'addTenant',\n      'mousedown .action-add-landlord': 'addLandlord',\n      'mousedown .action-add-property': 'addProperty',\n      // 'mousedown .action-add-transfer': 'addTransfer',\n      'click .action-logout': 'logout',\n      'click .action-toggle-sub': 'toggleSub',\n      'click .action-quick-add': 'toggleQuickAdd',\n      'blur .action-toggle-sub': 'toggleSub',\n      'blur .action-quick-add': 'toggleQuickAdd',\n      'mousedown .switches .tooltip a': 'quickLink'\n    },\n\n    initialize: function() {\n      var self = this;\n      // this.role = app.session.get('user_role');\n\n      // events\n      app.router.on('route', function(route, params) {\n        this.update();\n      }, this);\n\n      this.on({\n        'adminAdded': this.adminAdded,\n        'managerAdded': this.managerAdded,\n        'tenantAdded': this.tenantAdded,\n        'landlordAdded': this.landlordAdded,\n        'propertyAdded': this.propertyAdded,\n      });\n\n      this.update();\n      this.render();\n\n      return this;\n    },\n\n    update: function() {\n      var currentRoute = app.router.getRoute().split('?')[0];\n      this.$el.find('ul li a').removeClass('active');\n      this.$el.find('a[href=\"/' + currentRoute + '\"]').addClass('active');\n    },\n\n    render: function() {\n      this.$el.html(this.template({ \n        logo: app.templates.logo()\n      }));\n      return this;\n    },\n\n    logout: function() {\n      app.controls.logout();\n    },\n\n    toggleQuickAdd: function() {\n      var $tooltip = this.$el.find('.footer-actions .tooltip');\n      var $btn = this.$el.find('.action-quick-add');\n      if ($tooltip.hasClass('open')) {\n        $tooltip.removeClass('open');\n      } else {\n        $tooltip.addClass('open');\n        $btn.focus();\n      }\n    },\n\n    toggleSub: function(e) {\n      var $btn = $(e.currentTarget);\n      var $tooltip = $btn.next('.tooltip');\n\n      if ($tooltip.hasClass('open')) {\n        $tooltip.removeClass('open');\n      } else {\n        if (e.type == 'click') {\n          $tooltip.addClass('open');\n          $btn.focus();\n        }\n      }\n    },\n    \n    quickLink: function(e) { // fix for blur event listener bug\n      e.preventDefault();\n      var $target = $(e.currentTarget);\n      var url = $target.attr('href');\n\n      if (url === '#') return;\n      app.router.navigate(url, { trigger: true, replace: false });\n    },\n\n    addAdmin: function() {\n      this.modal = new ModalInviteView({\n        action: 'invite',\n        role: 'admin',\n        eventName: 'adminAdded',\n        context: this\n      });\n    },\n\n    addManager: function() {\n      // this.modelName = 'manager';\n      this.modal = new ModalInviteView({\n        action: 'invite',\n        role: 'manager',\n        eventName: 'managerAdded',\n        context: this\n      });\n    },\n\n    addTenant: function() {\n      // this.modelName = 'tenant';\n      this.modal = new ModalInviteView({\n        action: 'invite',\n        role: 'tenant',\n        eventName: 'tenantAdded',\n        context: this\n      });\n    },\n\n    addLandlord: function() {\n      // this.modelName = 'landlord';\n      this.modal = new ModalInviteView({\n        action: 'invite',\n        role: 'landlord',\n        eventName: 'landlordAdded',\n        context: this\n      });\n    },\n\n    addProperty: function() {\n      // this.modelName = 'property';\n      this.modal = new ModalPropertyView({\n        action: 'add',\n        eventName: 'propertyAdded',\n        context: this\n      });\n    },\n\n    addTransfer: function() {\n      // this.modelName = 'transfer';\n\n      var ModalTransferView = this.TransferModal;\n      this.modal = new ModalTransferView({\n        action: 'add',\n        type: 'electronic',\n        eventName: 'transferAdded',\n        context: this\n      });\n    },\n\n    adminAdded: function() {\n      app.router.navigate('/admins', { trigger: true });\n    },\n\n    managerAdded: function() {\n      app.router.navigate('/managers', { trigger: true });\n    },\n\n    tenantAdded: function() {\n      app.router.navigate('/tenants', { trigger: true });\n    },\n\n    landlordAdded: function() {\n      app.router.navigate('/landlords', { trigger: true });\n    },\n\n    propertyAdded: function() {\n      app.router.navigate('/properties', { trigger: true });\n    },\n\n  });\n});"]}