define(["app","view/cards/user","view/modals/ModalLeaseView","view/modals/ModalBillView","model/users/TenantModel","model/properties/PropertyModel","model/leases/LeaseModel","text!templates/leases/lease.html","text!templates/repeaters/charge.html","text!templates/headers/header-tertiary-model.html"],function(e,t,i,a,o,r,n,s,l,d){return Backbone.View.extend({className:"model-view lease-view",events:{"click .action-add-bill":"addBill","click .action-edit":"editLease","click .action-save":"promptSave","click .action-delete":"promptDelete","click .action-close":"hideTertiary"},template:_.template(s),template_container:_.template(d),options:{edit:!0,delete:!0},initialize:function(e){_.extend(this,e);var t=this;this.model=new n({_id:this._id}),this.model.fetch().then(function(){t.render()})},render:function(){var i=this;this.on("leaseEdited",this.leaseEdited,this),this.on("confirmDelete",this.deleteModel,this),this.leases=this.model.get("unit.leases"),this.property=new r(this.model.get("property")),console.warn(this.model);var a=this.model.toJSON(),n={model:this.model.get("lease")};this.$el.html(this.template_container({header:n,options:this.options})),this.$el.find(".scroll-y").html(this.template({lease:a}));var s=this.model.get("tenants");_.each(s,function(e){var a=new o(e),r=new t({data:a.toJSON()});i.$el.find(".grid").append(r.$el)});var d=this.model.get("charges");return d.recurring&&d.recurring.length>1?d.recurring.forEach(function(t){if("rent"==t.type)return!1;var a=_.template(l),o=e.utils.capitalize(t.type),r={amount:e.utils.prettyMoney(t.amount),type:o,description:t.description,date:moment.utc(t.date).format("MM/DD/YYYY")};i.$el.find(".recurring").append(a({charge:r}))}):this.$el.find(".recurring").remove(),d.scheduled&&d.scheduled.length>0?d.scheduled.forEach(function(t){var a,o=_.template(l);a="first_month"==t.type?"First Month":"last_month"==t.type?"Last Month":e.utils.capitalize(t.type);var r={amount:e.utils.prettyMoney(t.amount),type:a,date:moment.utc(t.date).format("MM/DD/YYYY")};i.$el.find(".scheduled").append(o({charge:r}))}):this.$el.find(".scheduled").remove(),$('.row[data-id="'+e.views.currentView.selected+'"]').addClass("selected"),$(".tertiary").removeClass("loading"),this},promptDelete:function(){var t=this.model.get("lease"),i="Are you sure you want to delete "+t+"?";e.controls.modalConfirm(i,"confirmDelete",this)},saveModel:function(){var t=$(".form-model"),i=t.serializeArray(),a={};$.map(i,function(e){a[e.name]=e.value}),this.model.save(a).then(function(){e.router.navigate("properties",{trigger:!0})},function(){e.router.navigate("properties",{trigger:!0}),e.alerts.success("No changes were made.")})},deleteModel:function(t,i){var a=this,o=$.Deferred();return this.model.destroy().then(function(){var t=e.router.getRoute();e.router.navigate(t,{trigger:!0}),o.resolve()}).fail(function(t){i||e.controls.handleError(t,null,a,"deleteModel"),o.reject(t)}),o},hideTertiary:function(){e.controls.hideTertiary()},addLease:function(){this.modal=new i({action:"add",unit:this.model,property:this.property,context:this,eventName:"leaseCreated",leases:this.leases})},editLease:function(e){this.modal=new i({action:"edit",unit:this.model,property:this.property,context:this,eventName:"leaseEdited",model:this.model,leases:this.leases})},renewLease:function(e){this.modal=new i({action:"renew",unit:this.model,property:this.property,context:this,eventName:"leaseRenewed",model:this.model,leases:this.leases})},addBill:function(){var e=this.model.toJSON(),t=e.unit._id,i=e.property._id;new a({action:"add",context:this,eventName:"modelAdded",unit_id:t,property_id:i})},leaseEdited:function(){this.initialize(),e.views.currentView.initialize()}})});
//# sourceMappingURL=LeaseView.js.map
