{"version":3,"sources":["view/repeaters/charge.js"],"names":["define","app","ChargeTemplate","DateTemplate","Backbone","View","extend","tagName","events","click .action-delete","change .charge","template","_","initialize","options","this","type","description","render","self","$el","html","amount","id","name","controls","maskMoney","smartTextarea","dateinput","prepend","$date_field","find","selected_date","date","moment","Kalendae","Input","months","direction","selected","subscribe","context","trigger","validateCharge","e","$","currentTarget","val","invalid","utils","validateMoney","fieldError","element","error","closeView","indexKey","min","close"],"mappings":"AAIAA,QACE,MAEA,6CACA,4CAEF,SAASC,EAAKC,EAAgBC,GAE5B,MAAOC,UAASC,KAAKC,QAEnBC,QAAS,KAETC,QACEC,uBAAwB,YACxBC,iBAAkB,kBAGpBC,SAAUC,EAAED,SAAST,GAErBW,WAAY,SAASC,GAEnBC,KAAKD,SACHE,MAAM,EACNC,aAAa,GAEfL,EAAEN,OAAOS,KAAMD,GAGfC,KAAKG,UAGPA,OAAQ,WACN,GAAIC,GAAOJ,IAiBX,IAXAA,KAAKK,IAAIC,KAAKN,KAAKJ,UACjBW,OAAQP,KAAKO,OACbC,GAAIR,KAAKQ,GACTP,KAAMD,KAAKC,KACXQ,KAAMT,KAAKS,KACXV,QAASC,KAAKD,WAGhBb,EAAIwB,SAASC,UAAU,UAAWX,MAClCd,EAAIwB,SAASE,cAAcZ,MAEV,aAAbA,KAAKC,KAAqB,CAC5B,GAAIY,GAAYhB,EAAED,SAASR,EAC3BY,MAAKK,IAAIS,QAAQD,GACfJ,KAAMT,KAAKS,KACXD,GAAIR,KAAKQ,KAGX,IAAIO,GAAcf,KAAKK,IAAIW,KAAK,SAE5BC,EAAgBjB,KAAKkB,KAAOC,OAAOnB,KAAKkB,MAAQC,QAEpDnB,MAAKkB,KAAO,GAAIE,UAASC,MAAMN,EAAY,IACzCO,OAAQ,EACRC,UAAW,eACXC,SAAUP,IAGZjB,KAAKkB,KAAKO,UAAU,OAAQ,WAC1BrB,EAAKsB,QAAQC,QAAQ,mBAGzB,MAAO3B,OAGT4B,eAAgB,SAASC,GACvB,GAAItB,GAASuB,EAAED,EAAEE,eAAeC,MAC5BC,EAAU/C,EAAIgD,MAAMC,cAAc5B,EAElC0B,IACF/C,EAAIwB,SAAS0B,YACXC,QAASP,EAAED,EAAEE,eACb9B,KAAM,QACNqC,MAAOL,KAKbM,UAAW,WACJvC,KAAKwC,WAAUxC,KAAKwC,SAAW,iBAEhCxC,KAAK0B,QAAQ1B,KAAKwC,YAAcxC,KAAKyC,MACzCzC,KAAK0B,QAAQ1B,KAAKwC,YAClBxC,KAAK0C","file":"charge.js","sourcesContent":["/**\n * /repeaters/charge.js\n */\n\ndefine([\n  'app',\n  // 'model/leases/ChargeModel',\n  'text!templates/repeaters/charge-input.html',\n  'text!templates/repeaters/date-input.html',\n],\nfunction(app, ChargeTemplate, DateTemplate) {\n\n  return Backbone.View.extend({\n\n    tagName: 'li',\n\n    events: {\n      'click .action-delete': 'closeView',\n      'change .charge': 'validateCharge'\n    },\n\n    template: _.template(ChargeTemplate),\n\n    initialize: function(options) {\n\n      this.options = {\n        type: true, \n        description: true\n      };\n      _.extend(this, options);\n\n      // this.model = new ChargeModel();\n      this.render();\n    },\n\n    render: function() {\n      var self = this;\n\n      // Backbone.Validation.bind(this);\n\n      // console.log(this.type, this.name)\n\n      this.$el.html(this.template({\n        amount: this.amount,\n        id: this.id,\n        type: this.type,\n        name: this.name,\n        options: this.options\n      }));\n\n      app.controls.maskMoney('.charge', this);\n      app.controls.smartTextarea(this);\n\n      if (this.type == 'scheduled') {\n        var dateinput = _.template(DateTemplate);\n        this.$el.prepend(dateinput({ \n          name: this.name,\n          id: this.id\n        }));\n\n        var $date_field = this.$el.find('.date');\n\n        var selected_date = this.date ? moment(this.date) : moment();\n\n        this.date = new Kalendae.Input($date_field[0], {\n          months: 1,\n          direction: 'today-future',\n          selected: selected_date,\n        });\n\n        this.date.subscribe('show', function() {\n          self.context.trigger('calendar-open');\n        });\n      }\n      return this;\n    },\n\n    validateCharge: function(e) {\n      var amount = $(e.currentTarget).val();\n      var invalid = app.utils.validateMoney(amount);\n      \n      if (invalid) {\n        app.controls.fieldError({\n          element: $(e.currentTarget),\n          type: 'error',\n          error: invalid\n        });\n      }\n    },\n\n    closeView: function() {\n      if (!this.indexKey) this.indexKey = 'chargeCounter';\n\n      if (this.context[this.indexKey] === this.min) return;\n      this.context[this.indexKey]--;\n      this.close();\n    }\n\n  });\n});"]}