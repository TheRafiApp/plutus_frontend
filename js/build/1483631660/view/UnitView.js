define(["app","kalendae","model/users/TenantModel","model/properties/UnitModel","view/modals/ModalLeaseView","view/cards/lease","text!templates/units/unit.html","text!templates/headers/header-tertiary-panel-model.html"],function(e,t,i,n,a,o,s,l){return Backbone.View.extend(_.extend({},Backbone.Events,{className:"model-view unit-view",events:{"click .action-close":"closePanel","click .action-edit":"toggleEdit","click .action-cancel":"cancelEdit","click .action-save":"promptSave","click .action-delete":"promptDelete","click .action-add-lease":"addLease","click .action-back":"closePanel"},template:_.template(s),template_container:_.template(l),initialize:function(e){_.extend(this,e);var t=this;this.model=new n({_id:this._id},{parentModelId:this.parentModelId}),Backbone.Validation.bind(this),this.model.fetch().then(function(){t.render()})},attachEvents:function(){this.on("confirmSave",this.saveModel,this),this.on("confirmDelete",this.deleteModel,this),this.on("leaseCreated",this.initialize,this),this.on("leaseEdited",this.initialize,this),this.on("leaseRenewed",this.initialize,this),this.on("modalClosed",this.clearModal,this),this.listening=!0},render:function(){this.listening||this.attachEvents();var e=this,t=this.model.toJSON(),n={model:this.model.get("number_pretty")};this.$el.html(this.template_container({header:n})),this.$el.find(".scroll-y").html(this.template({unit:t})),this.leases=this.model.get("leases"),_.each(this.leases,function(t){var n=[];_.each(t.tenants,function(e){var t=new i(e);n.push(t.toJSON())});var a=new o({data:t,tenants:n,parentView:e});e.$el.find(".grid").append(a.$el)});var a=setTimeout(function(){$("body").removeClass("tertiary-hidden"),e.$el.addClass("active"),clearTimeout(a)},90);return $(".quarternary").removeClass("loading"),this},toggleEdit:function(){var e=this.$el.find(".action-edit"),t=e.parent().parent(),i=this.$el.find("form.form-model");i.hasClass("editing")?(t.removeClass("editing"),i.removeClass("editing"),i.find("input").prop("disabled",!0)):(t.addClass("editing"),i.addClass("editing"),i.find("input").prop("disabled",!1))},cancelEdit:function(){this.render()},constructData:function(){var t=this.$el.find("form"),i=t.serializeObject();return e.schema.process(i,this.model)},saveModel:function(){var t=this.constructData();console.log(t),this.model.save(t).then(function(){var t=e.router.getPath().split("/");t.pop(),t=t.join("/"),e.controls.hideQuarternary({trigger:!1}),e.router.navigate(t,{trigger:!0})},function(e){console.warn(e)})},promptSave:function(){if(!e.utils.validate(this))return!1;var t=this.model.get("number"),i="You have made changes to "+t+". Are you sure you want to save your changes?";e.controls.modalConfirm(i,"confirmSave",this)},promptDelete:function(){var t=this.model.get("number"),i="Are you sure you want to delete #"+t+"?";e.controls.modalConfirm(i,"confirmDelete",this)},deleteModel:function(t,i){var n=this,a=$.Deferred();return this.model.destroy().then(function(){var t=e.router.getRoute();return e.router.navigate(t,{trigger:!0}),a.resolve()}).fail(function(t){return i||e.controls.handleError(t,null,n,"deleteModel"),a.reject(t)}),a},closePanel:function(){e.controls.hideQuarternary({trigger:!0})},addLease:function(){this.modal=new a({action:"add",context:this,eventName:"leaseCreated"})},editLease:function(e){this.modal=new a({action:"edit",context:this,eventName:"leaseEdited",model:e.model})},renewLease:function(e){this.modal=new a({action:"renew",context:this,eventName:"leaseRenewed",model:e.model})},clearModal:function(){delete this.modal}}))});
//# sourceMappingURL=UnitView.js.map
