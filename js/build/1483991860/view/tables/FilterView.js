define(["app","vendor/nouislider","text!templates/repeaters/date-range.html","text!templates/repeaters/filter.html","text!templates/tables/filters.html"],function(t,e,i,s,a){return Backbone.View.extend({className:"filter",events:{"change .filter-checkbox":"changeFilter","click .action-clear-column":"clearFilters"},template:_.template(a),initialize:function(t){t&&_.extend(this,t),this.render()},render:function(){return"date_range"==this.type?this.renderDateRange():this.renderFilters(),this},dateToTimestamp:function(t){return console.log(t),t.toDate().getTime()},renderDateRange:function(t){var s=this;this.date_template=_.template(i),this.slider_loaded=0,this.$slider&&this.$slider.destroy(),this.dates=this.attrs_all.map(function(t){return moment.utc(t)});var a,l,n=_.min(this.dates),r=_.max(this.dates);t?(t=t.map(function(t){return moment.utc(t)}),a=_.min(t),l=_.max(t)):(a=n,l=r),n.isSame(r)&&(r=moment.utc(r).add("days",1)),a.isSame(l)&&(l=moment.utc(l).add("days",1)),this.$el.html(this.template()),this.$el.find(".filters").html(this.date_template());var d=this.$el.find(".slider")[0];console.log(this.$el.find(".slider")),this.$slider=e.create(d,{range:{min:this.dateToTimestamp(n),max:this.dateToTimestamp(r)},connect:!0,step:864e5,start:[this.dateToTimestamp(a),this.dateToTimestamp(l)],format:{to:function(t){return parseInt(t)},from:function(t){return parseInt(t)}}});var h=[this.$el.find("#event-start")[0],this.$el.find("#event-end")[0]];d.noUiSlider.on("update",function(t,e){s.slider_loaded++,s.slider_loaded>=2&&s.changeDates(),h[e].innerHTML=moment(+t[e]).format("MM/DD/YYYY")})},renderFilters:function(e){var i=this,a=!1;this.filter_template=_.template(s),this.$el.html(this.template()),this.attrs_all.forEach(function(s){var l=!1,n=!1,r=i.context.filters[i.field];r&&r.indexOf(s+"")>-1&&(l=!0,a=!0),e&&e.indexOf(s)<0&&(n=!0),i.$el.find(".filters").append(i.filter_template({attr:s,id:i.field+"--"+t.utils.domFriendlyString(s),checked:l,disabled:n}))});var l=this.context.$el.find('.header.fixed a[data-field="'+this.field+'"]').parent();a?l.addClass("has-filters"):l.removeClass("has-filters")},changeFilter:function(t){var e=$(t.currentTarget),i=e[0].checked,s=e.attr("data-value");this.context.filters[this.field];i?this.context.filters[this.field].push(s):this.context.filters[this.field]=_.without(this.context.filters[this.field],s);var a=this.context.$el.find('.fixed a[data-field="'+this.field+'"]');0===a.length&&(a=this.context.$el.find('.fixed a[data-field-sort="'+this.field+'"]')),a=a.parent(),0===this.context.filters[this.field].length?a.removeClass("has-filters"):a.addClass("has-filters"),this.context.filterCollection(this.field)},changeDates:function(){console.log(this.context.filters),this.context.filters[this.field].dates=this.$slider.get(),this.$slider.get().forEach(function(t){console.log(moment(t).format("MM/DD/YYYY"))}),this.$el.is(":visible")&&this.context.filterCollection(this.field)},clearFilters:function(){"date_range"!==this.type&&(this.context.filters[this.field]=[]),this.context.filterCollection(),"date_range"==this.type?this.renderDateRange():this.renderFilters()}})});
//# sourceMappingURL=FilterView.js.map
