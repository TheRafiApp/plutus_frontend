{"version":3,"sources":["view/ModelView.js"],"names":["define","app","HeaderTemplate","Backbone","View","extend","_","Events","className","events","click .action-edit","click .action-cancel","click .action-save","click .action-delete","click .action-back","click .action-close","template_container","template","initialize","options","this","router","getRoute","context","model","render","Validation","bind","on","saveModel","deleteModel","data","toJSON","header_info","display_name","$el","html","header","find","mask","$","views","currentView","selected","addClass","removeClass","toggleEdit","edit","$btn","$actions","parent","$form","hasClass","prop","cancelEdit","promptSave","utils","validate","target","message","controls","modalConfirm","promptDelete","data_array","serializeArray","formData","map","x","save","success","route","navigate","trigger","error","alerts","event","override","self","promise","Deferred","destroy","then","resolve","fail","handleError","reject","hideTertiary","modelView"],"mappings":"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","file":"ModelView.js","sourcesContent":["/**\n * ModelView.js\n */\n\ndefine([\n  'app',\n  'text!templates/headers/header-tertiary-model.html',\n],\nfunction(app, HeaderTemplate) {\n\n  return Backbone.View.extend(_.extend({}, Backbone.Events, {\n\n    className: 'model-view',\n\n    events: {\n      'click .action-edit': 'toggleEdit',\n      'click .action-cancel': 'cancelEdit',\n      'click .action-save': 'promptSave',\n      'click .action-delete': 'promptDelete',\n      'click .action-back': 'hideTertiary',\n      'click .action-close': 'hideTertiary'\n    },\n\n    template_container: _.template(HeaderTemplate),\n\n    initialize: function(options) {\n      _.extend(this, options);\n      var self = this;\n      var role = app.router.getRoute();\n\n      this.template = this.context.template;\n\n      var Model = this.model;\n      this.model = this.context.model;\n      this.render();\n\n      Backbone.Validation.bind(this);\n    },\n\n    render: function() {\n      this.on('confirmSave', this.saveModel, this);\n      this.on('confirmDelete', this.deleteModel, this);\n\n      var data = this.model.toJSON();\n\n      var header_info = {\n        model: this.model.display_name()\n      };\n\n      this.$el.html(this.template_container({ \n        header: header_info,\n        options: this.options\n      }));\n\n      this.$el.find('.scroll-y').html(this.template({ model: data }));\n\n      this.$el.find('input[name=\"phone_pretty\"]').mask('(000) 000-0000');\n\n      $('.row[data-id=\"' + app.views.currentView.selected + '\"]').addClass('selected');\n      $('.tertiary').removeClass('loading');\n\n      return this;\n    },\n\n    toggleEdit: function() {\n      if (!this.options.edit) return;\n\n      var $btn = this.$el.find('.action-edit');\n      var $actions = $btn.parent().parent();\n      var $form = this.$el.find('form.form-model');\n\n      if ($form.hasClass('editing')) {\n        $actions.removeClass('editing');\n        $form.removeClass('editing');\n        $form.find('input').prop('disabled', true);\n      } else {\n        $actions.addClass('editing');\n        $form.addClass('editing');\n        $form.find('input').prop('disabled', false);\n      }\n    },\n\n    cancelEdit: function() {\n      if (!this.options.edit) return;\n      \n      this.render();\n    },\n\n    promptSave: function() {\n      if (!app.utils.validate(this)) return false;\n\n      var target = this.model.display_name();\n      var message = 'You have made changes to ' + target + '. Are you sure you want to save your changes?';\n\n      app.controls.modalConfirm(message, 'confirmSave', this);\n    },\n\n    promptDelete: function() {\n      var target = this.model.display_name();\n      var message = 'Are you sure you want to delete ' + target + '?';\n\n      app.controls.modalConfirm(message, 'confirmDelete', this);\n    },\n\n    saveModel: function() {\n      var self = this;\n      var $form = $('.form-model');\n      var data_array = $form.serializeArray();\n      var formData = {};\n\n      $.map(data_array, function(x) {\n        formData[x['name']] = x['value'];\n      });\n\n      // Save to server\n      this.model.save(formData).success(function() {\n        var route = app.router.getRoute();\n        app.router.navigate(route, { trigger: true });\n      }).error(function() {\n        app.router.navigate(route, { trigger: true });\n        app.alerts.success('No changes were made.');\n      });\n    },\n\n    deleteModel: function(event, override) {\n      var self = this;\n      var promise = $.Deferred();\n\n      this.model.destroy().then(function() {\n        var route = app.router.getRoute();\n        app.router.navigate(route, { trigger: true });\n\n        promise.resolve();\n\n      }).fail(function(error) {\n        if (!override) app.controls.handleError(error, null, self, 'deleteModel');\n        promise.reject(error);\n      });\n\n      return promise;\n    },\n\n    hideTertiary: function() {\n      if (app.views.modelView) app.controls.hideTertiary();\n    },\n\n  }));\n});"]}