define(["app","text!templates/account/account-activation.html"],function(t,e){return Backbone.View.extend({className:"activation dark",template:_.template(e),events:{"click .breadcrumb":"goToStep"},dwolla_data:{},initialize:function(e){e&&_.extend(this,e);var s=t.models.AccountModel;if(this.user=this.user?new s(this.user):t.session.user,this.user.get("status.active")===!1)t.utils.stash.removeItem("authorization"),t.utils.stash.removeItem("refresh");else if(t.session.get("logged_in")===!1)return t.router.navigate("/",{trigger:!0,replace:!0}),t.alerts.error("You have already activated your account, please log in");return this.$el.html(this.template()),this.$el.append(t.templates.logo()),this.render(),this},updateUser:function(t){_.extend(this.user,t),this.initialize()},render:function(){$("body").removeClass("loading");return this.renderSteps(),this},checkStep:function(){for(var t=0;t<this.steps.length;t++){var e=this.steps[t];if(!e.value){this.currentStep=e,this.showStep(e);break}t===this.steps.length-1&&this.loginAndClose()}},renderSteps:function(){if(this.steps=t.utils.getOnboardingSteps(this.user.toJSON()),console.log(this.steps),this.steps.length>1)for(var e=0;e<this.steps.length;e++){var s=$("<a>",{href:"#",class:"breadcrumb","data-name":this.steps[e].name,"data-step":e});this.$el.find(".breadcrumbs").append(s)}this.$el.find(".container").append($('<div class="fade"></div>')),this.fade=this.$el.find(".fade"),this.checkStep()},showStep:function(e){var s=this;t.utils.loadView.get("account/activate/"+e.name).then(function(t){s.currentView=new t({step:e,parentView:s});var i=e.options.background;s.$el.css("background-color",i).find(".step").html(s.currentView.$el),s.fade.css("box-shadow","inset 0 -19px 10px -12px "+i),s.updateBreadcrumbs(e),s.$el.find(".container").removeClass("loading")})},updateBreadcrumbs:function(t){var e=t.index;this.$el.find(".breadcrumb").removeClass("current");for(var s=0;s<=e;s++)this.$el.find('.breadcrumb[data-step="'+s+'"]').addClass("active");this.$el.find('.breadcrumb[data-step="'+e+'"]').addClass("current")},next:function(){var t=this.currentStep.index+1;return t>this.steps.length-1?void this.loginAndClose():(this.currentStep=this.steps[t],void this.showStep(this.currentStep))},loginAndClose:function(){var e=this;t.router.checkAuth().then(function(){e.close()}).fail(function(){t.controls.login().then(function(){e.close()})})},goToStep:function(t){var e=$(t.currentTarget).attr("data-step");this.currentStep=this.steps[e],this.showStep(this.currentStep)},setDwollaData:function(t){_.extend(this.dwolla_data,t)}})});
//# sourceMappingURL=Activate.js.map
